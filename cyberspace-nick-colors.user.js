// ==UserScript==
// @name         Cyberspace Nick Colors
// @author       https://z0m.bi/ (@z0ylent)
// @namespace    https://cyberspace.online/
// @version      1.1
// @description  Consistent bright colors for usernames across the site
// @match        https://cyberspace.online/*
// @updateURL    https://github.com/z0mbieparade/cyberspace-nick-colors/raw/refs/heads/main/cyberspace-nick-colors.user.js
// @downloadURL  https://github.com/z0mbieparade/cyberspace-nick-colors/raw/refs/heads/main/cyberspace-nick-colors.user.js
// @grant        GM_registerMenuCommand
// @grant        GM.registerMenuCommand
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_xmlhttpRequest
// @connect      raw.githubusercontent.com
// @connect      gist.githubusercontent.com
// @run-at       document-idle
// ==/UserScript==

!function(){"use strict";const e=document.createElement("style");e.id="nc-styles",e.textContent='.nc-dialog-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:999999}.nc-dialog{background:var(--nc-bg);border:1px solid var(--nc-border);color:var(--nc-fg);max-height:80vh;display:flex;flex-direction:column}.nc-dialog .spacer{flex:1}.nc-dialog h3{margin:0;color:var(--nc-fg);font-size:var(--font-size-base, 1rem);text-transform:uppercase;letter-spacing:.05em}.nc-dialog h4{margin:.5rem 0;color:var(--nc-fg);font-size:var(--font-size-base, 1rem);text-transform:uppercase;letter-spacing:.1em}.nc-dialog h4:first-child{margin-top:0;padding-top:0}.nc-dialog hr{border:1px dashed var(--nc-border);background:rgba(0,0,0,0);height:0;margin:1rem 0}.nc-dialog .nc-input-row,.nc-dialog .nc-input-row-stacked{padding:.5rem 0;display:flex;flex-direction:row;gap:.5rem}.nc-dialog .nc-input-row-stacked{flex-direction:column;gap:.25rem}.nc-dialog .nc-input-row.no-padding-bottom,.nc-dialog .nc-input-row-stacked.no-padding-bottom{padding-bottom:0}.nc-dialog .nc-input-row.no-padding-top,.nc-dialog .nc-input-row-stacked.no-padding-top{padding-top:0}.nc-dialog .nc-input-row label{font-size:calc(var(--font-size-base)*.875);color:var(--nc-fg)}.nc-dialog .hint{font-size:calc(var(--font-size-base, 1rem)*.875);color:var(--nc-fg-dim)}.nc-dialog .buttons{display:flex;gap:.5rem;justify-content:flex-end}.nc-dialog button{flex:1 0 auto;padding:.5rem}.nc-dialog button:hover{border-color:var(--nc-fg-dim)}.nc-dialog button.link-brackets{background:none;border:none;padding:0;color:var(--nc-fg-dim);flex:0 0 auto}.nc-dialog button.link-brackets:hover{border-color:var(--nc-fg)}.nc-dialog button.link-brackets .inner::before{content:"["}.nc-dialog button.link-brackets .inner::after{content:"]"}.nc-dialog button.nc-inline-btn{flex:0 0 auto;padding:.25rem .75rem;font-size:var(--font-size-base);background:var(--nc-bg);border:1px solid var(--nc-border);color:var(--nc-fg-dim);cursor:pointer;transition:border-color .15s,color .15s}.nc-dialog button.nc-inline-btn:hover{border-color:var(--nc-fg);color:var(--nc-fg)}.nc-dialog input[type=text],.nc-dialog textarea,.nc-dialog select{width:100%;padding:.5rem;background:var(--nc-bg);border:1px solid var(--nc-border);color:var(--nc-fg);font-family:inherit;font-size:var(--font-size-base);box-sizing:border-box}.nc-dialog textarea{min-height:70px;resize:vertical}.nc-dialog .nc-toggle{display:flex;margin:.5rem 0}.nc-dialog .nc-toggle-label{display:inline-flex;align-items:center;gap:.75rem;cursor:pointer;flex-shrink:0}.nc-dialog .nc-toggle-value{font-size:var(--font-size-base);color:var(--nc-fg-dim);text-transform:uppercase;letter-spacing:.05em}.nc-dialog .nc-toggle-track{position:relative;width:2.5rem;height:1.25rem;border:1px solid var(--nc-border);border-radius:var(--radius-md);transition:background-color .15s}.nc-dialog .nc-toggle-track.active{background:var(--nc-fg)}.nc-dialog .nc-toggle-track:not(.active){background:var(--nc-fg-dim)}.nc-dialog .nc-toggle-thumb{position:absolute;top:2px;width:1rem;height:.875rem;background:var(--nc-bg);border-radius:var(--radius-md);transition:transform .15s}.nc-dialog .nc-toggle-thumb.pos-start{transform:translateX(2px)}.nc-dialog .nc-toggle-thumb.pos-middle{transform:translateX(10px)}.nc-dialog .nc-toggle-thumb.pos-end{transform:translateX(20px)}.nc-dialog .nc-sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);border:0}.nc-dialog .nc-text-dim{color:var(--nc-fg-dim)}.nc-dialog .nc-dialog-attribution{width:100%;display:flex;justify-content:flex-end;gap:.5rem;border-top:1px dotted var(--nc-border);margin-top:.3rem;font-size:calc(var(--font-size-base)*.875);color:var(--nc-fg-dim);padding-top:.3rem}.nc-dialog .nc-dialog-attribution a{color:var(--nc-fg-dim);text-decoration:none}.nc-dialog .nc-dialog-error{font-size:calc(var(--font-size-base)*.875);color:var(--nc-error);background-color:var(--nc-error-bg);border:1px dashed var(--nc-error)}.nc-dialog .nc-dialog-warning{font-size:calc(var(--font-size-base)*.875);color:var(--nc-warn);background-color:var(--nc-warn-bg);border:1px dashed var(--nc-warn)}.nc-dialog .nc-dialog-success{font-size:calc(var(--font-size-base)*.875);color:var(--nc-success);background-color:var(--nc-success-bg);border:1px dashed var(--nc-success)}.nc-dialog .nc-dialog-info{font-size:calc(var(--font-size-base)*.875);color:var(--nc-info);background-color:var(--nc-info-bg);border:1px dashed var(--nc-info)}.nc-dialog .nc-flex{display:flex}.nc-dialog .nc-flex-wrap{flex-wrap:wrap}.nc-dialog .nc-flex-shrink-0{flex-shrink:0}.nc-dialog .nc-items-center{align-items:center}.nc-dialog .nc-justify-between{justify-content:space-between}.nc-dialog .nc-gap-2{gap:.5rem}.nc-dialog .nc-gap-3{gap:.75rem}.nc-dialog .nc-gap-4{gap:1rem}.nc-dialog .nc-cursor-pointer{cursor:pointer}.nc-dialog pre,.nc-dialog div.nc-dialog-debug{max-width:100%;background-color:var(--nc-code-bg);color:var(--nc-fg);font-size:calc(var(--font-size-base)*.875);padding:.5rem;border:2px dashed var(--nc-border)}.nc-dialog pre{white-space:pre-wrap;word-wrap:break-word;overflow-wrap:break-word}.nc-dialog div.nc-dialog-debug{display:flex;flex-direction:column;gap:.5rem}.nc-dialog div.nc-dialog-debug>span{display:flex;flex-direction:row;gap:.25rem;width:100%;max-width:100%;min-width:0}.nc-dialog div.nc-dialog-debug>span>*{flex:0 1 auto}.nc-dialog div.nc-dialog-debug>span>strong{flex:0 0 auto;font-weight:bold;min-width:7.5rem;text-align:right}.nc-dialog .nc-debug-color{display:inline-block;padding:0 .25em;font-size:.75em;border:1px solid var(--nc-border)}.nc-dialog-header{padding:1rem 1rem .5rem;border-bottom:1px solid var(--nc-border);flex-shrink:0;width:100%;box-sizing:border-box;gap:.5rem}.nc-dialog-content{padding:.5rem 1rem;overflow-y:auto;flex:1}.nc-dialog-preview{padding:.5rem 1rem;border-bottom:1px solid var(--nc-border);flex-shrink:0;background:var(--nc-code-bg)}.nc-dialog-preview .preview,.nc-dialog-preview .preview-row{font-size:var(--font-size-base);line-height:var(--font-size-base);margin:0;border:1px solid var(--nc-border);padding:.25rem;margin:.5rem 0;background:var(--nc-bg);max-height:3.1rem;overflow:hidden}.nc-dialog-preview .preview.preview-inverted,.nc-dialog-preview .preview-row.preview-inverted{background:var(--nc-inverted-bg);color:var(--nc-inverted-fg)}.nc-dialog-preview .preview-row{display:flex;gap:.25rem;flex-wrap:wrap;justify-content:space-around}.nc-dialog-preview .preview-nick{padding:.125rem .25rem !important}.nc-dialog-footer{padding:.5rem 1rem .5rem;border-top:1px solid var(--nc-border);flex-shrink:0}.nc-slider{position:relative;height:24px;margin:.5rem 0 .25rem}.nc-slider.nc-slider-simple{height:16px}.nc-slider.nc-slider-simple .nc-slider-track{inset:7px 0;height:2px;border:none;background:var(--nc-border)}.nc-slider.nc-slider-simple .nc-slider-thumb{top:3px;width:10px;height:10px;border-radius:50%}.nc-slider.nc-slider-simple .nc-slider-thumb::before{content:"";position:absolute;inset:-8px}.nc-slider.nc-slider-split{height:34px}.nc-slider.nc-slider-split .nc-slider-track{top:calc(50% + 1px);bottom:4px}.nc-slider.nc-slider-split .nc-slider-track-mapped{display:block !important}.nc-slider.nc-slider-split .nc-slider-thumb{height:32px}.nc-slider-track{position:absolute;inset:4px 0;border:1px solid var(--nc-border);background:var(--nc-code-bg);box-sizing:border-box}.nc-slider-track-mapped{display:none;position:absolute;top:4px;bottom:calc(50% + 1px);left:0;right:0;border:1px solid var(--nc-border);background:var(--nc-code-bg);box-sizing:border-box}.nc-slider-thumb{position:absolute;top:0;width:14px;height:22px;background:var(--nc-fg);border:2px solid var(--nc-bg);outline:1px solid var(--nc-border);cursor:ew-resize;transform:translateX(-50%);z-index:2;display:flex;align-items:center;justify-content:center;font-size:8px;color:var(--nc-bg);user-select:none;box-sizing:border-box}.nc-slider-labels{display:flex;justify-content:space-between;font-size:calc(var(--font-size-base, 1rem)*.625);line-height:calc(var(--font-size-base, 1rem)*.625);margin-bottom:.5rem}.nc-slider-labels,.nc-slider-labels span{color:var(--nc-fg-dim)}.nc-debug-tooltip{position:fixed;z-index:9999999;background:var(--nc-bg, #0a0a0a);border:1px solid var(--nc-border, #333);color:var(--nc-fg, #e0e0e0);padding:.25rem;font-size:11px;font-family:monospace;max-width:350px;opacity:0;pointer-events:none;transition:opacity .15s;box-shadow:0 2px 8px rgba(0,0,0,.5)}.nc-debug-tooltip.visible{opacity:1}.nc-debug-row{display:flex;gap:.5rem;padding:.125rem 0;border-bottom:1px dotted var(--nc-border, #333)}.nc-debug-row:last-child{border-bottom:none}.nc-debug-label{color:var(--nc-fg-dim, #888);min-width:90px;flex-shrink:0}.nc-debug-value{color:var(--nc-fg, #e0e0e0);display:flex;align-items:center;gap:.25rem}.nc-debug-swatch{display:inline-block;width:12px;height:12px;border:1px solid var(--nc-border, #333);flex-shrink:0}.nc-has-debug{cursor:help}html[data-theme=poetry] [data-mention-colored=true],html[data-theme=poetry] [data-nick-colored=true]{border-radius:var(--radius-md)}',document.head.appendChild(e);const GM_setValue="function"==typeof window.GM_setValue?window.GM_setValue:(e,t)=>localStorage.setItem("nickColors_"+e,t),GM_getValue="function"==typeof window.GM_getValue?window.GM_getValue:(e,t)=>{const n=localStorage.getItem("nickColors_"+e);return null!==n?n:t};function t(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function n(e){const n=t(e);if(!n)return null;let o=n.r/255,i=n.g/255,s=n.b/255;const a=Math.max(o,i,s),r=Math.min(o,i,s);let l,c,d=(a+r)/2;if(a===r)l=c=0;else{const e=a-r;switch(c=d>.5?e/(2-a-r):e/(a+r),a){case o:l=((i-s)/e+(i<s?6:0))/6;break;case i:l=((s-o)/e+2)/6;break;case s:l=((o-i)/e+4)/6}}return{h:Math.round(360*l),s:Math.round(100*c),l:Math.round(100*d)}}function o(e,t,n){let o,i,s;if(e/=360,n/=100,0==(t/=100))o=i=s=n;else{const a=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e),r=n<.5?n*(1+t):n+t-n*t,l=2*n-r;o=a(l,r,e+1/3),i=a(l,r,e),s=a(l,r,e-1/3)}return{r:Math.round(255*o),g:Math.round(255*i),b:Math.round(255*s)}}function i(e,i="hsl"){if(!e)return null;let s,a,r;"string"==typeof e?(s=e.match(/hsla?\(([\d.]+),\s*([\d.]+)%?,\s*([\d.]+)%?(?:,\s*[\d.]+)?\)/),a=e.match(/rgba?\(([\d.]+),\s*([\d.]+),\s*([\d.]+)(?:,\s*[\d.]+)?\)/),r=e.match(/^#([a-f\d]{6}|[a-f\d]{3})$/i)):"object"==typeof e&&(void 0!==e.h&&void 0!==e.s&&void 0!==e.l?s=[null,e.h,e.s,e.l]:void 0!==e.r&&void 0!==e.g&&void 0!==e.b&&(a=[null,e.r,e.g,e.b]));const l=i.match("-string")?"string":"object";if("hsl"===(i=i.replace(/-string|-object$/,""))){if(s)return"string"===l?`hsl(${(+s[1]).toFixed(1)}, ${(+s[2]).toFixed(1)}%, ${(+s[3]).toFixed(1)}%)`:{h:+s[1],s:+s[2],l:+s[3]};if(a){const e=function(e,t,n){e/=255,t/=255,n/=255;const o=Math.max(e,t,n),i=Math.min(e,t,n);let s,a,r=(o+i)/2;if(o===i)s=a=0;else{const l=o-i;switch(a=r>.5?l/(2-o-i):l/(o+i),o){case e:s=((t-n)/l+(t<n?6:0))/6;break;case t:s=((n-e)/l+2)/6;break;case n:s=((e-t)/l+4)/6}}return{h:360*s,s:100*a,l:100*r}}(+a[1],+a[2],+a[3]);return"string"===l?`hsl(${e.h.toFixed(1)}, ${e.s.toFixed(1)}%, ${e.l.toFixed(1)}%)`:{h:e.h,s:e.s,l:e.l}}if(r)return n(e)}else if("rgb"===i){if(a)return"string"===l?`rgb(${(+a[1]).toFixed(1)}, ${(+a[2]).toFixed(1)}, ${(+a[3]).toFixed(1)})`:{r:+a[1],g:+a[2],b:+a[3]};if(s){const e=o(+s[1],+s[2],+s[3]);return"string"===l?`rgb(${e.r.toFixed(1)}, ${e.g.toFixed(1)}, ${e.b.toFixed(1)})`:{r:e.r,g:e.g,b:e.b}}if(r)return t(e)}else if("hex"===i){if(r)return e;if(s)return rgbToHex(o(+s[1],+s[2],+s[3]));if(a)return rgbToHex({r:+a[1],g:+a[2],b:+a[3]})}return null}function s(e){const t=i(e,"rgb");if(!t)return 0;const{r:n,g:o,b:s}=t,a=n/255,r=o/255,l=s/255;return.2126*(a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4))+.7152*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))+.0722*(l<=.03928?l/12.92:Math.pow((l+.055)/1.055,2.4))}function a(e,t){const n=s(e),o=s(t);return(Math.max(n,o)+.05)/(Math.min(n,o)+.05)}function r(e){if(e||(e=H),!e)return null;if(F[e])return F[e];const t=e.toLowerCase();for(const[e,n]of Object.entries(F))if(e.toLowerCase()===t)return n;return null}function l(e=null,l=null){const c=document.documentElement,u=getComputedStyle(c),g=(e=e??c.dataset.theme??document.body?.dataset?.theme)?r(e):null,p=M?{bg:M.bg,fg:M.fg,fgDim:M.fgDim||M.dim,border:M.border,codeBg:M.codeBg||M.code_bg}:null,f=F["Full Spectrum"].colors;function m(e){return!(!e||"transparent"===e||"none"===e||!t(e)&&!e.startsWith("rgb")&&!e.startsWith("hsl"))}function h(e,t){const n=u.getPropertyValue(e).trim();return m(n)?n:p&&m(p[t])?p[t]:g&&g.colors&&m(g.colors[t])?g.colors[t]:f[t]}let b=h("--color-fg","fg"),v=h("--color-bg","bg");if(g?.logic){const e=g.logic.invertedContainerBg??"fg",t=g.logic.invertedContainerFg??"bg",n="--color-"+d(e),o="--color-"+d(t);b=h(n,e),v=h(o,t)}const y={bg:h("--color-bg","bg"),fg:h("--color-fg","fg"),fgDim:h("--color-fg-dim","fgDim"),border:h("--color-border","border"),codeBg:h("--color-code-bg","codeBg"),invertedBg:b,invertedFg:v,error:"#ff6b6b",warn:"#ffd93d",success:"#6bcb77",info:"#4d96ff",errorBg:"#1a0d0d",warnBg:"#1a250d",successBg:"#152a15",infoBg:"#15152a"},x=n(y.fg)||i(y.fg,"hsl"),S=n(y.bg)||i(y.bg,"hsl");function C(e,t,n,i,r=4.5){let l=n,c=o(e,t,l),d=a(c,i);if(d>=r)return`hsl(${e}, ${t}%, ${l}%)`;const u=s(i)>.5?-5:5;for(let n=0;n<15&&(l=Math.max(5,Math.min(95,l+u)),c=o(e,t,l),d=a(c,i),!(d>=r));n++);return`hsl(${e}, ${t}%, ${l}%)`}if(x&&S){let e=Math.max(x.s,50),t=x.l;(t<20||t>80)&&(t=50,e=Math.max(e,70));const n=o(S.h,S.s,S.l);y.error=C(0,e,t,n),y.warn=C(45,e,t,n),y.success=C(120,e,t,n),y.info=C(210,e,t,n)}if(S){let e=Math.max(S.s,20),t=S.l;t<5?(t=10,e=Math.max(e,30)):t>95&&(t=90,e=Math.max(e,30)),y.errorBg=`hsl(0, ${e}%, ${t}%)`,y.warnBg=`hsl(45, ${e}%, ${t}%)`,y.successBg=`hsl(120, ${e}%, ${t}%)`,y.infoBg=`hsl(210, ${e}%, ${t}%)`}if(l)for(const e in y){const t=i(y[e],l);t&&(y[e]=t)}return y}function c(e){const t=r(e=e??H??"Full Spectrum");return{theme:e,colors:l(e),colorVariables:l(e,"hsl"),settings:{...w,...t?.settings||{}}}}function d(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}function u(e){return e.replace(/-([a-z])/g,(e,t)=>t.toUpperCase())}function g(e){const t={};return e.split(/[;\n]/).forEach(e=>{const n=e.trim();if(!n)return;const o=n.indexOf(":");if(-1===o)return;const i=n.slice(0,o).trim(),s=n.slice(o+1).trim();if(i&&s){const e=i.replace(/-([a-z])/g,(e,t)=>t.toUpperCase());t[e]=s}}),t}function p(e,t="; "){return Object.entries(e).map(([e,t])=>`${d(e)}: ${t}`).join(t)}function f(e,t,n){if(0===t&&360===n)return e;const o=e/360;if(t<=n)return t+o*(n-t);{const e=t+o*(360-t+n);return e>=360?e-360:e}}function m(e,t,n){return 0===t&&100===n?e:t+e/100*(n-t)}function h(e,t,n=4.5,o="hsl"){let r=a(e,t);const l={adjusted:!1},c=i(e,"hsl"),d=i(t,"hsl");if(!c||!d)return l.colorAdjust=t,l.colorCompare=e,l.contrast=r,l.loopCount=0,l;let u=0;for(;r<n&&u<20;){const e=s(c),t=s(d);0===d.l||100===d.l?e>t?c.l+=5:c.l-=5:t>e?d.l+=5:d.l-=5,r=a(c,d),u++,l.adjusted=!0}return l.colorAdjust=i(d,o),l.colorCompare=i(c,o),l.contrast=r,l.loopCount=u,l}function b(e,t="hsl",n={}){if(n={mapHue:!0,mapSat:!0,mapLit:!0,effectiveConfig:v(),...n},!e)return null;const o=i(e,"hsl");return o?i({h:n.mapHue?f(o.h,n.effectiveConfig.minHue??0,n.effectiveConfig.maxHue??360):o.h,s:n.mapSat?m(o.s,n.effectiveConfig.minSaturation??0,n.effectiveConfig.maxSaturation??100):o.s,l:n.mapLit?m(o.l,n.effectiveConfig.minLightness??0,n.effectiveConfig.maxLightness??100):o.l},t):null}function v(){const e={...j},t=l(null,"hsl"),n=i(t?.fg,"hsl")||{h:0,s:0,l:0};if(j.useSiteThemeHue&&(e.minHue=(n.h-j.hueSpread+360)%360,e.maxHue=(n.h+j.hueSpread)%360),j.useSiteThemeSat){const t=j.satSpread||0;e.minSaturation=Math.max(0,n.s-t),e.maxSaturation=Math.min(100,n.s+t)}if(j.useSiteThemeLit){const t=j.litSpread||0;e.minLightness=Math.max(0,n.l-t),e.maxLightness=Math.min(100,n.l+t)}return e}function y(e){let t=0;const n=e.toLowerCase().trim();for(let e=0;e<n.length;e++)t=n.charCodeAt(e)+((t<<5)-t),t&=t;return Math.abs(t)}function x(e=null){const t=l(e),n=document.documentElement;n.style.setProperty("--nc-bg",t.bg),n.style.setProperty("--nc-fg",t.fg),n.style.setProperty("--nc-fg-dim",t.fgDim),n.style.setProperty("--nc-border",t.border),n.style.setProperty("--nc-code-bg",t.codeBg),n.style.setProperty("--nc-inverted-bg",t.invertedBg),n.style.setProperty("--nc-inverted-fg",t.invertedFg),n.style.setProperty("--nc-error",t.error),n.style.setProperty("--nc-warn",t.warn),n.style.setProperty("--nc-success",t.success),n.style.setProperty("--nc-info",t.info),n.style.setProperty("--nc-error-bg",t.errorBg),n.style.setProperty("--nc-warn-bg",t.warnBg),n.style.setProperty("--nc-success-bg",t.successBg),n.style.setProperty("--nc-info-bg",t.infoBg)}function S(){document.querySelectorAll("[data-nick-colored]").forEach(e=>{e.dataset.originalText&&(e.textContent=e.dataset.originalText),delete e.dataset.nickColored,delete e.dataset.iconApplied,delete e.dataset.originalText,delete e.dataset.username,e.style.cssText=""}),document.querySelectorAll("[data-mention-colored]").forEach(e=>{const t=e.dataset.username,n=t?`@${t}`:e.textContent;e.replaceWith(document.createTextNode(n))}),de()}let C="true"===GM_getValue("debugMode","false");const k="https://github.com/z0mbieparade/cyberspace-nick-colors/raw/refs/heads/main/overrides.json";let $={};const w={useSingleColor:!1,useSiteThemeHue:!1,useSiteThemeSat:!1,useSiteThemeLit:!1,singleColorHue:180,singleColorSat:85,singleColorLit:65,singleColorCustom:"",satSpread:15,hueSpread:30,litSpread:10,minHue:0,maxHue:360,minSaturation:70,maxSaturation:100,minLightness:55,maxLightness:75,contrastThreshold:4.5,varyWeight:!1,varyItalic:!1,varyCase:!1,prependIcon:!1,appendIcon:!1,iconSet:"● ○ ◆ ◇ ■ □ ▲ △ ★ ☆ ♦ ♠ ♣ ♥ ☢ ☣ ☠ ⚙ ⬡ ⬢ ♻ ⚛ ⚠ ⛒"},L=['a[href^="/"]'],E=[".chat-main-content",".profile-box-inverted"],T=[".sidebar","footer",".nc-dialog-attribution","code","pre","script"],I=["feed","topics","jukebox","notes","write","chat","messages","bookmarks","notifications","me","guilds","support","wiki","changelog","netiquette","faq","loading","error"],N=[".profile-box-inverted"],F={"Full Spectrum":{colors:{fg:"#e0e0e0",bg:"#0a0a0a",fgDim:"#888888",border:"#333333",codeBg:"#222222"},settings:{minSaturation:70,maxSaturation:100,minLightness:55,maxLightness:75,minHue:0,maxHue:360,contrastThreshold:4.5}},z0ylent:{colors:{fg:"#91ff00",bg:"#060f04",fgDim:"#12892d",border:"#12892d",codeBg:"#0c1c08"},settings:{minSaturation:80,maxSaturation:100,minLightness:45,maxLightness:65,minHue:60,maxHue:150,contrastThreshold:4.5}},Dark:{colors:{fg:"#efe5c0",bg:"#000000",fgDim:"#a89984",border:"#3a3a3a",codeBg:"hsla(0,0%,100%,.07)"},settings:{minSaturation:12,maxSaturation:60,minLightness:65,maxLightness:80,minHue:0,maxHue:70,contrastThreshold:4.5}},Light:{colors:{fg:"#000000",bg:"#efe5c0",fgDim:"#3a3a3a",border:"#a89984",codeBg:"rgba(0,0,0,.08)"},settings:{minSaturation:12,maxSaturation:60,minLightness:30,maxLightness:45,minHue:344,maxHue:44,contrastThreshold:4.5}},C64:{colors:{fg:"hsla(0,0%,100%,.75)",bg:"#2a2ab8",fgDim:"hsla(0,0%,100%,.4)",border:"hsla(0,0%,100%,.3)",codeBg:"hsla(0,0%,100%,.08)"},settings:{minSaturation:70,maxSaturation:90,minLightness:60,maxLightness:75,minHue:180,maxHue:280,contrastThreshold:4.5}},VT320:{colors:{fg:"#ff9a10",bg:"#170800",fgDim:"#ff9100",border:"rgba(255,155,0,.27)",codeBg:"rgba(255,155,0,.05)"},settings:{minSaturation:90,maxSaturation:100,minLightness:50,maxLightness:65,minHue:15,maxHue:55,contrastThreshold:4.5}},Matrix:{colors:{fg:"rgba(160,224,68,.9)",bg:"#000000",fgDim:"rgba(160,224,68,.5)",border:"rgba(160,224,68,.4)",codeBg:"rgba(0,255,65,.08)"},settings:{minSaturation:75,maxSaturation:95,minLightness:45,maxLightness:60,minHue:70,maxHue:140,contrastThreshold:4.5}},Poetry:{colors:{fg:"#222222",bg:"#fefaf8",fgDim:"#666666",border:"#cccccc",codeBg:"#f0e0dd"},settings:{minSaturation:0,maxSaturation:35,minLightness:30,maxLightness:45,minHue:339,maxHue:46,contrastThreshold:4.5},logic:{invertedContainerBg:"codeBg",invertedContainerFg:"fg"}},Brutalist:{colors:{fg:"#c0d0e8",bg:"#080810",fgDim:"#99a9bf",border:"rgba(160,180,220,.18)",codeBg:"rgba(160,180,220,.06)"},settings:{minSaturation:50,maxSaturation:70,minLightness:60,maxLightness:75,minHue:180,maxHue:260,contrastThreshold:4.5}},GRiD:{colors:{fg:"#fea813",bg:"#180f06",fgDim:"#d08c17",border:"rgba(245,169,28,.22)",codeBg:"rgba(245,169,28,.08)"},settings:{minSaturation:90,maxSaturation:100,minLightness:50,maxLightness:65,minHue:20,maxHue:60,contrastThreshold:4.5}},System:{colors:{fg:"#efe5c0",bg:"#000000",fgDim:"#a89984",border:"#3a3a3a",codeBg:"hsla(0,0%,100%,.07)"},settings:{minSaturation:60,maxSaturation:80,minLightness:65,maxLightness:80,minHue:0,maxHue:360,contrastThreshold:4.5}}};let V=null,H=null,M=null;try{H=document.documentElement?.dataset?.theme||null}catch(be){}function R(){try{const e=localStorage.getItem("custom_theme");e&&(M=JSON.parse(e))}catch(e){console.log("[Nick Colors] Could not parse site custom_theme:",e)}}function O(){const e=l();console.log("[Nick Colors] Theme variables:",e),e&&e.fg&&e.bg&&(H=document.documentElement?.dataset?.theme||null,V={...e})}R(),V||O();let j={...w};function A(){GM_setValue("siteConfig",JSON.stringify(j))}!function(){try{const e=GM_getValue("siteConfig",null);e&&(j={...w,...JSON.parse(e)})}catch(e){console.error("[Nick Colors] Failed to load site config:",e)}}();let D={};function q(){GM_setValue("customNickColors",JSON.stringify(D))}function W(){const e={version:1,exportedAt:(new Date).toISOString()},t=function(e,t){const n={};for(const o of Object.keys(e))JSON.stringify(e[o])!==JSON.stringify(t[o])&&(n[o]=e[o]);return Object.keys(n).length>0?n:null}(j,w);return t&&(e.siteConfig=t),Object.keys(D).length>0&&(e.customNickColors=D),e}function z(e){try{return e&&"object"==typeof e?(e=_(e)).version&&e.version>1?{success:!1,message:`Export version ${e.version} is newer than supported version 1`}:(e.siteConfig&&(j={...w,...e.siteConfig},A()),e.customNickColors&&(D={...e.customNickColors},q()),S(),{success:!0,message:"Settings imported successfully"}):{success:!1,message:"Invalid data format"}}catch(e){return{success:!1,message:`Import failed: ${e.message}`}}}!function(){try{const e=GM_getValue("customNickColors","{}");D=JSON.parse(e)}catch(e){D={}}}();const B={minSaturation:"mS",maxSaturation:"xS",minLightness:"mL",maxLightness:"xL",minHue:"mH",maxHue:"xH",contrastThreshold:"cT",useSiteThemeHue:"uH",hueSpread:"hS",useSiteThemeSat:"uS",satSpread:"sS",useSiteThemeLit:"uL",litSpread:"lS",varyWeight:"vW",varyItalic:"vI",varyCase:"vC",prependIcon:"pI",appendIcon:"aI",iconSet:"iS",color:"c",backgroundColor:"bg",fontWeight:"fW",fontStyle:"fS",fontVariant:"fV",invert:"inv",siteConfig:"sc",customNickColors:"cnc",version:"v",exportedAt:"at"},G=Object.fromEntries(Object.entries(B).map(([e,t])=>[t,e]));function P(e){if(null===e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(P);const t={};for(const[n,o]of Object.entries(e))t[B[n]||n]=P(o);return t}function _(e){if(null===e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(_);const t={};for(const[n,o]of Object.entries(e))t[G[n]||n]=_(o);return t}function J(e,t){!function(e,t){const n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),o=URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}(P(e),t)}async function U(e){try{return await navigator.clipboard.writeText(JSON.stringify(P(e))),!0}catch(e){throw new Error(`Failed to copy: ${e.message}`)}}function Z(e){const t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=t=>{const n=t.target.files[0];if(!n)return;const o=new FileReader;o.onload=t=>{try{const n=_(JSON.parse(t.target.result));e(n,null)}catch(t){e(null,new Error(`Failed to parse file: ${t.message}`))}},o.readAsText(n)},t.click()}function X(e){const t=document.createElement("div");t.className="nc-dialog-overlay",t.innerHTML='\n\t\t<div class="nc-dialog" style="min-width: 400px; max-width: 500px;">\n\t\t\t<div class="nc-dialog-header nc-flex nc-justify-between">\n\t\t\t\t<h3>Paste Settings</h3>\n\t\t\t\t<div class="spacer"></div>\n\t\t\t\t<button class="nc-header-close link-brackets"><span class="inner">ESC</span></button>\n\t\t\t</div>\n\t\t\t<div class="nc-dialog-content">\n\t\t\t\t<div class="hint">Paste your settings JSON below (Ctrl+V or right-click → Paste)</div>\n\t\t\t\t<textarea id="paste-settings-input" style="min-height: 150px; width: 100%; font-size: var(--font-size-base);" placeholder="Paste settings JSON here..."></textarea>\n\t\t\t</div>\n\t\t\t<div class="nc-dialog-footer">\n\t\t\t\t<div class="buttons nc-flex nc-items-center nc-gap-2">\n\t\t\t\t\t<button class="nc-import-btn link-brackets"><span class="inner">IMPORT</span></button>\n\t\t\t\t\t<button class="nc-cancel-btn link-brackets"><span class="inner">CANCEL</span></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t';const n=()=>t.remove(),o=t.querySelector("#paste-settings-input");t.querySelector(".nc-header-close").addEventListener("click",n),t.querySelector(".nc-cancel-btn").addEventListener("click",n),t.querySelector(".nc-import-btn").addEventListener("click",()=>{const t=o.value.trim();if(t)try{const o=_(JSON.parse(t));n(),e(o,null)}catch(t){e(null,new Error(`Failed to parse: ${t.message}`))}else alert("Please paste settings JSON first")}),t.addEventListener("click",e=>{e.target===t&&n()}),t.addEventListener("keydown",e=>{"Escape"===e.key&&n()}),document.body.appendChild(t),o.focus()}function K(e,t=null){const n=`https://cyberspace.online/${e}`;if(window.location.pathname===`/${e}`)return console.log("navigated to user profile, triggering compose shortcut"),void document.dispatchEvent(new KeyboardEvent("keydown",{key:"c",code:"KeyC",bubbles:!0}));sessionStorage.setItem("nickColors_openCompose","true"),t&&sessionStorage.setItem("nickColors_composeMessage",t),window.location.href=n}if("true"===sessionStorage.getItem("nickColors_openCompose")){function ve(e=0){console.log(`[NickColors] tryOpenCompose attempt ${e}, readyState: ${document.readyState}`);let t=null;const n=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,null,!1);let o;for(;o=n.nextNode();){const e=o.textContent?.trim()||"";if(e.includes("[C]")&&e.includes("C-Mail")){t=o.parentElement,console.log(`[NickColors] Found text node with C-Mail, parent: ${t?.tagName}, text: "${e}"`);break}}if(t){console.log("[NickColors] Found C-Mail button, clicking it:",t),t.click();const e=sessionStorage.getItem("nickColors_composeMessage");e&&(sessionStorage.removeItem("nickColors_composeMessage"),setTimeout(()=>ye(e,0),300))}else e>30?console.log("[NickColors] Max attempts reached, giving up"):(console.log("[NickColors] C-Mail button not found, retrying in 500ms"),setTimeout(()=>ve(e+1),500))}function ye(e,t){console.log(`[NickColors] tryFillMessage attempt ${t}`);const n=document.querySelector('input[placeholder="Type a message..."], textarea[placeholder="Type a message..."]');n?(console.log("[NickColors] Found message input, filling it"),n.focus(),n.value=e,n.dispatchEvent(new Event("input",{bubbles:!0}))):t<20?setTimeout(()=>ye(e,t+1),200):console.log("[NickColors] Could not find message input, giving up")}sessionStorage.removeItem("nickColors_openCompose"),console.log("[NickColors] Detected openCompose flag, will try to open compose"),console.log("[NickColors] readyState:",document.readyState),"complete"===document.readyState?(console.log("[NickColors] Page already complete, starting in 1s"),setTimeout(ve,1e3)):(console.log("[NickColors] Waiting for load event"),window.addEventListener("load",()=>{console.log("[NickColors] Load event fired, starting in 1s"),setTimeout(ve,1e3)}))}function Y(e,t=""){const n=C?"":' style="display: none;"',o="nc-dialog-debug"+(t?" "+t:"");return"string"==typeof e?`<div class="${o}"${n}>${e}</div>`:(console.log(e),`<div class="${o}"${n}>\n${Object.entries(e).map(([e,t])=>"object"!=typeof t||void 0===t.txt&&void 0===t.elem?"string"==typeof t?`<span><strong>${e}:</strong><span>${t??"N/A"}</span></span>`:void 0:`<span><strong>${e}:</strong><span>${t.txt??" N/A"}${t.elem?" "+t.elem:""}</span></span>`).filter(e=>e&&""!==e.trim()).join("\n").trim()}\n</div>`)}function Q(e,t=""){let n=e.querySelector(".nc-dynamic-debug");return n||(n=document.createElement("div"),n.className="nc-dynamic-debug nc-dialog-debug"+(t?" "+t:""),e.appendChild(n)),n.style.display=C?"":"none",n}function ee(){const e=v(),t=[];t.push("=".repeat(60)),t.push("NICK COLORS DEBUG LOG"),t.push("=".repeat(60)),t.push(""),t.push(`Exported: ${(new Date).toISOString()}`),t.push(`URL: ${window.location.href}`),t.push(`User Agent: ${navigator.userAgent}`),t.push(""),t.push("-".repeat(60)),t.push("SITE THEME"),t.push("-".repeat(60)),t.push(`Site Theme: ${V?JSON.stringify(V):"none"}`),t.push(""),t.push("-".repeat(60)),t.push("EFFECTIVE CONFIG (after site theme integration)"),t.push("-".repeat(60)),t.push(JSON.stringify(e,null,2)),t.push(""),t.push("-".repeat(60)),t.push("SITE CONFIG"),t.push("-".repeat(60)),t.push(JSON.stringify(j,null,2)),t.push(""),t.push("-".repeat(60)),t.push("STYLE CONFIG"),t.push("-".repeat(60)),t.push(JSON.stringify(j,null,2)),t.push(""),t.push("-".repeat(60)),t.push(`CUSTOM NICK COLORS (${Object.keys(D).length} total)`),t.push("-".repeat(60)),t.push(JSON.stringify(D,null,2)),t.push(""),t.push("-".repeat(60)),t.push(`MANUAL OVERRIDES (${Object.keys($).length} total)`),t.push("-".repeat(60)),t.push(JSON.stringify($,null,2)),t.push("");const n=document.querySelectorAll(".nc-dialog-debug, .nc-dynamic-debug");return n.length>0&&(t.push("-".repeat(60)),t.push(`DEBUG ELEMENTS (${n.length} found)`),t.push("-".repeat(60)),n.forEach((e,n)=>{t.push(`[${n+1}] ${e.textContent.trim()}`)}),t.push("")),t.push("=".repeat(60)),t.push("END OF DEBUG LOG"),t.push("=".repeat(60)),t.join("\n")}function te(e){delete e.appendIcon,delete e.prependIcon,delete e.invert;for(const t in e)if(t.startsWith("color")&&"string"!=typeof e[t]){const n=i(e[t],"hsl");n?e[t]=n:delete e[t]}else t.startsWith("base")&&delete e[t];return e}function ne(e,t="hsl",n={}){n={includeStyles:!1,effectiveConfig:v(),debugData:!1,...n};let o={color:null},s=[];if(D[e]){const a=D[e],r="string"==typeof a?a:a.color;if(r){const e=i(r,t);e&&(o.color=e),s.push(["Source","Custom"])}n.includeStyles&&"object"==typeof a&&(o={...a,...o})}if(null===o.color&&$[e]){const a=$[e],r="string"==typeof a?a:a.color;if(r){const e=i(r,t);e&&(o.color=e),s.push(["Source","Override"])}n.includeStyles&&"object"==typeof a&&(o={...a,...o})}if(n.effectiveConfig.useSingleColor){let e;e=n.effectiveConfig.singleColorCustom&&i(n.effectiveConfig.singleColorCustom,"hsl")||{h:n.effectiveConfig.singleColorHue,s:n.effectiveConfig.singleColorSat,l:n.effectiveConfig.singleColorLit},o={...o,color:i(e,t)},delete o.backgroundColor}if(null===o.color){const n={h:y(e)%360,s:y(e+"_sat")%101,l:y(e+"_lit")%101};o={...o,color:i(n,t)},s.push(["Source","Hashed"])}if(n.includeStyles){const t=ie(e);if(n.effectiveConfig.varyWeight&&!o.fontWeight&&(o.fontWeight=t.fontWeight),n.effectiveConfig.varyItalic&&!o.fontStyle&&(o.fontStyle=t.fontStyle),n.effectiveConfig.varyCase&&!o.fontVariant&&(o.fontVariant=t.fontVariant),n.effectiveConfig.prependIcon||n.effectiveConfig.appendIcon){const t=oe(e,{effectiveConfig:n.effectiveConfig});!1!==o.appendIcon&&(o.appendIcon=t),!1!==o.prependIcon&&(o.prependIcon=t)}}return n.debugData&&(o.debugData=s),n.includeStyles?o:o.color}function oe(e,t={}){if(!(t={effectiveConfig:v(),...t}).effectiveConfig.prependIcon&&!t.effectiveConfig.appendIcon||!t.effectiveConfig.iconSet)return null;const n=t.effectiveConfig.iconSet.split(/\s+/).filter(Boolean);return 0===n.length?null:n[y(e+"_icon")%n.length]}function ie(e){return{fontWeight:y(e+"_fontWeight")%2==0?"normal":"bold",fontStyle:y(e+"_fontStyle")%4==0?"italic":"normal",fontVariant:y(e+"_fontVariant")%4==1?"small-caps":"normal"}}function se(e,t,n={}){n={matchType:"nick",mergeStyles:{},overridesStyles:null,themeName:H,effectiveConfig:v(),debugData:!1,...n};let o=[];e.querySelector(".nc-nick-debug")&&e.querySelector(".nc-nick-debug").remove();const s=n.isInverted??(N.length>0&&N.some(t=>e.closest(t)));let{styles:r,nickConfig:c,contrastRatio:g,debugData:p}=function(e,t={}){let n=[];const o=(t={themeName:H,effectiveConfig:v(),isInverted:!1,debugData:!1,...t}).effectiveConfig.contrastThreshold||4.5,s=function(e,t="hsl",n={}){const o=ne(e,t,n={includeStyles:!1,effectiveConfig:v(),debugData:!1,...n});let i=null,s=[];if(!0===n.includeStyles){n.debugData&&(s=o.debugData||[],delete o.debugData),i={...o};for(const e in o)e.startsWith("color")&&(i[u("base-"+e)]=o[e],i[e]=b(o[e],t,{effectiveConfig:n.effectiveConfig}));n.debugData&&(i.debugData=s)}else i=b(o,t,{effectiveConfig:n.effectiveConfig});return i}(e,"hsl",{includeStyles:!0,effectiveConfig:t.effectiveConfig,debugData:t.debugData}),r=l(t.themeName);t.debugData&&(n=s.debugData||[],delete s.debugData);let c=i(s.color,"rgb"),d=t.isInverted?r.invertedBg:r.bg;const g=i(d,"rgb");n.push(["Element BG",d?i(g,"hsl-string"):"N/A"]);let p=i(s.backgroundColor??d,"rgb");n.push(["Nick FG (raw)",c?i(c,"hsl-string"):"N/A"]),n.push(["Nick BG (raw)",p?i(p,"hsl-string"):"N/A"]);let f=a(c,p);n.push(["Contrast (raw)",+f.toFixed(2)]);let m=!1;!0===s.invert||!1===s.invert?(m=s.invert,n.push(["User Invert",s.invert])):o>0&&(m=f<o,n.push(["Thresh Invert",m]));const y=i(s.color,"hsl-string"),x=s.backgroundColor?i(s.backgroundColor,"hsl-string"):null,S=te(s);if(S.padding="0 0.25rem",S.color=y,m){let e=y,s=x||function(e,t="hsl",n={}){const o=l((n={themeName:H,isInverted:!1,...n}).themeName,"hsl");let s=n.isInverted?o.invertedBg:o.bg,r=n.isInverted?o.invertedFg:o.fg;return i(a(s,e)>a(r,e)?s:r,t)}(y,"hsl-string",{themeName:t.themeName,isInverted:!0,effectiveConfig:t.effectiveConfig,debugData:t.debugData});if(t.effectiveConfig.useSingleColor)S.color=s,S.backgroundColor=e;else{const t=h(e,s,o,"hsl-string");S.color=t.colorAdjust,S.backgroundColor=t.colorCompare}n.push(["Nick FG (adj)",S.color||"N/A"]),n.push(["Nick BG (adj)",S.backgroundColor||"N/A"]),f=a(S.color,S.backgroundColor)}else{if(!t.effectiveConfig.useSingleColor){const e=h(p,y,o,"hsl-string");S.color=e.colorAdjust,n.push(["Nick FG (adj)",S.color||"N/A"])}f=a(S.color,p)}return n.push(["Contrast (adj)",+f.toFixed(2)]),{styles:S,nickConfig:s,debugData:n}}(t,{themeName:n.themeName,effectiveConfig:n.effectiveConfig,debugData:n.debugData,isInverted:s});if(o=[...o,...p||[]],r={...r,...n.mergeStyles},n.overrideStyles&&"object"==typeof n.overrideStyles&&(r={...n.overrideStyles}),r.data){for(const t in r.data)e.dataset[t]=r.data[t];delete r.data}for(const t in r){const n=d(t);e.style.setProperty(n,r[t],"important")}e.dataset[`${n.matchType}Colored`]="true",e.dataset.username=t,e.dataset.contrastRatio=g;const f=c.prependIcon,m=c.appendIcon;if(f||m){e.dataset.iconApplied||(e.dataset.originalText=e.textContent,e.dataset.iconApplied="true");let t=e.dataset.originalText||e.textContent;f&&(t=f+" "+t),m&&(t=t+" "+m),e.textContent=t}else e.dataset.iconApplied&&(e.dataset.originalText&&(e.textContent=e.dataset.originalText),delete e.dataset.iconApplied,delete e.dataset.originalText);return n.debugData&&(e.dataset.ncDebug=JSON.stringify(o),e.classList.add("nc-has-debug"),e.addEventListener("mouseenter",re),e.addEventListener("mouseleave",le)),e}let ae=null;function re(e){const t=e.currentTarget,n=JSON.parse(t.dataset.ncDebug||"[]");ae||(ae=document.createElement("div"),ae.className="nc-debug-tooltip",document.body.appendChild(ae)),ae.innerHTML=n.map(([e,t])=>`<div class="nc-debug-row"><span class="nc-debug-label">${e}:</span> <span class="nc-debug-value">${"string"==typeof t&&t.startsWith("hsl")?`<span class="nc-debug-swatch" style="background:${t}"></span>${t}`:t}</span></div>`).join("");const o=t.getBoundingClientRect();ae.style.left=o.left+"px",ae.style.top=o.bottom+4+"px",ae.classList.add("visible")}function le(){ae&&ae.classList.remove("visible")}function ce(e){return!!e&&(e.startsWith("@")&&(e=e.slice(1)),e=e.trim().toLowerCase(),!I.includes(e)&&!e.includes(" "))}function de(){const e=L.join(", ");document.querySelectorAll(e).forEach(e=>{if(!function(e){if(e.dataset.nickColored)return!1;const t=e.textContent.trim();if(t.includes(" ")){const e=t.split(" ");if(2!==e.length||e[1].includes(" ")||0===e[1].length)return!1}const n=e.getAttribute("href")||"";return!((n.match(/\//g)||[]).length>1)&&(!(E.length>0&&!E.some(t=>e.closest(t)))&&(!(T.length>0&&T.some(t=>e.closest(t)))&&ce(n.startsWith("/")?n.slice(1):n)))}(e))return;const t=function(e){const t=e.getAttribute("href");if(t&&t.startsWith("/")){const e=t.slice(1);if(!e.includes("/")&&!e.includes(".")){const e=t.match(/^\/([^\/\?#]+)/);if(e&&ce(e[1]))return e[1]}}if(e.dataset.username&&ce(e.dataset.username))return e.dataset.username;let n=e.textContent.trim();if(n.includes(" ")){const e=n.split(" ");n=e[e.length-1]}return n&&n.length<30&&(n.startsWith("@")&&(n=n.slice(1)),ce(n))?n:null}(e);t&&se(e,t)}),function(){const e=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:e=>{if(!e.textContent.includes("@"))return NodeFilter.FILTER_REJECT;if(e.parentElement?.closest("[data-mention-colored]"))return NodeFilter.FILTER_REJECT;if(e.parentElement?.closest("[data-nick-colored]"))return NodeFilter.FILTER_REJECT;if(e.parentElement?.closest(".nc-dialog-preview"))return NodeFilter.FILTER_REJECT;const t=e.parentElement?.tagName;return"SCRIPT"===t||"STYLE"===t||"TEXTAREA"===t||"INPUT"===t||T.length>0&&T.some(t=>e.parentElement?.closest(t))?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),t=[];let n;for(;n=e.nextNode();)t.push(n);t.forEach(e=>{const t=e.textContent,n=/@([a-zA-Z0-9_-]+)/g;let o;const i=[];for(;null!==(o=n.exec(t));){if(o.index>0&&/[a-zA-Z0-9._-]/.test(t[o.index-1]))continue;const e=t.slice(o.index+o[0].length);/^\.[a-zA-Z]/.test(e)||ce(o[1])&&i.push({full:o[0],username:o[1],index:o.index})}if(0===i.length)return;const s=document.createDocumentFragment();let a=0;i.forEach(n=>{n.index>a&&s.appendChild(document.createTextNode(t.slice(a,n.index)));const o=document.createElement("span");o.textContent=n.full;const i=N.length>0&&!!e.parentElement?.closest(N.join(", "));se(o,n.username,{matchType:"mention",isInverted:i}),s.appendChild(o),a=n.index+n.full.length}),a<t.length&&s.appendChild(document.createTextNode(t.slice(a))),e.parentNode.replaceChild(s,e)})}()}function ue(e){const{type:t="single",simple:n=!1,min:o=0,max:i=100,onChange:s,label:a}=e,r="range"===t,l=document.createElement("div");l.innerHTML=`\n\t\t${a?`<label>${a}</label>`:""}\n\t\t<div class="nc-slider${n?" nc-slider-simple":""}">\n\t\t\t<div class="nc-slider-track-mapped"></div>\n\t\t\t<div class="nc-slider-track"></div>\n\t\t\t${r?'<div class="nc-slider-thumb" data-i="0">▶</div><div class="nc-slider-thumb" data-i="1">◀</div>':'<div class="nc-slider-thumb" data-i="0"></div>'}\n\t\t</div>\n\t\t<div class="nc-slider-labels"><span></span>${r?"<span></span>":""}</div>\n\t`;const c=l.querySelector(".nc-slider-track"),d=l.querySelector(".nc-slider-track-mapped"),u=l.querySelectorAll(".nc-slider-thumb"),g=l.querySelectorAll(".nc-slider-labels span"),p=l.querySelector(".nc-slider");let f=r?[...e.values||[o,i]]:[e.value??o];function m(e){return(e-o)/(i-o)*100}function h(){u.forEach((e,t)=>e.style.left=m(f[t])+"%"),r?(g[0].contains(document.activeElement)||(g[0].textContent=`${f[0]}`),g[1].contains(document.activeElement)||(g[1].textContent=`${f[1]}`)):g[0].contains(document.activeElement)||(g[0].textContent=`${f[0]}`)}function b(e){if(r){const t=m(f[0]),n=m(f[1]),o=t>n,i=(e,t,n)=>{const[o,i,s,a,r]=e,[l,c,d,u,g]=t,p=g===r?0:(n-r)/(g-r);return[Math.round(o+p*(l-o)),Math.round(i+p*(c-i)),Math.round(s+p*(d-s)),a+p*(u-a),n]},s=t=>{for(let n=0;n<e.length-1;n++)if(t>=e[n][4]&&t<=e[n+1][4])return[e[n],e[n+1]];return[e[0],e[e.length-1]]},a=[],r=e.map(e=>e[4]);[...new Set([...r,t,n])].sort((e,t)=>e-t).forEach(e=>{const[r,l]=s(e),c=i(r,l,e);if(e===t||e===n)e===t?(a.push([...c.slice(0,3),.5,e]),a.push([...c.slice(0,3),1,e])):(a.push([...c.slice(0,3),1,e]),a.push([...c.slice(0,3),.5,e]));else{const i=o?e>=t||e<=n:e>=t&&e<=n;a.push([...c.slice(0,3),i?c[3]:.5,e])}}),e=a}c.style.background=`linear-gradient(to right, ${e.map(e=>{const[t,n,o,i=1,s=null]=e;let a=`hsla(${t}, ${n}%, ${o}%, ${i})`;return null!==s&&(a+=` ${s}%`),a}).join(", ")})`}g.forEach((e,t)=>{return a=t,(n=e).style.cursor="pointer",n.title="Click to edit",void n.addEventListener("click",e=>{if(n.querySelector("input"))return;const t=f[a],l=document.createElement("input");l.type="number",l.min=o,l.max=i,l.value=t,l.style.cssText="width: 4em; text-align: center; font-size: inherit; padding: 0 0.25em; background: var(--nc-bg); border: 1px solid var(--nc-border); color: var(--nc-fg);",n.textContent="",n.appendChild(l),l.focus(),l.select(),l.addEventListener("blur",()=>{let e=parseInt(l.value,10);isNaN(e)&&(e=t),e=Math.max(o,Math.min(i,e)),f[a]=e,n.textContent=`${e}`,h(),s?.(r?[...f]:f[0])}),l.addEventListener("keydown",e=>{"Enter"===e.key?(e.preventDefault(),l.blur()):"Escape"===e.key&&(n.textContent=`${t}`)})});var n,a});let v=null;function y(e){const t=p.getBoundingClientRect(),n=(e.clientX??e.touches?.[0]?.clientX)-t.left;return s=Math.max(0,Math.min(100,n/t.width*100)),Math.round(o+s/100*(i-o));var s}function x(e){const t=e.target.closest(".nc-slider-thumb");t&&(v=+t.dataset.i,e.preventDefault())}function S(e){null!==v&&(f[v]=y(e),h(),s?.(r?[...f]:f[0]))}function C(){v=null}function k(e){return`linear-gradient(to right, ${e.map(e=>{const[t,n,o,i=1,s=null]=e;let a=`hsla(${t}, ${n}%, ${o}%, ${i})`;return null!==s&&(a+=` ${s}%`),a}).join(", ")})`}return p.addEventListener("mousedown",x),document.addEventListener("mousemove",S),document.addEventListener("mouseup",C),p.addEventListener("touchstart",x,{passive:!1}),document.addEventListener("touchmove",S,{passive:!1}),document.addEventListener("touchend",C),c.addEventListener("click",e=>{const t=y(e);if(r){const e=Math.abs(t-f[0]),n=Math.abs(t-f[1]);f[e<=n?0:1]=t}else f[0]=t;h(),s?.(r?[...f]:f[0])}),e.gradient&&b(e.gradient),h(),{el:l,getValue:()=>f[0],getValues:()=>[...f],setValue:e=>{f[0]=e,h()},setValues:e=>{f=[...e],h()},setGradient:b,setSplitGradient:function(e,t){if(!e)return p.classList.remove("nc-slider-split"),void(d.style.background="");p.classList.add("nc-slider-split"),d.style.background=k(e),c.style.background=k(t)},setThumbColor:function(e){const t=Array.isArray(e)?e:[e];u.forEach((e,n)=>{t[n]&&(e.style.background=t[n])})}}}function ge(e){const{label:t,id:n,type:o="text",value:i="",placeholder:s="",hint:a="",classes:r="",options:l,checked:c=!1,disabled:d=!1,state:u=null,defaultLabel:g="",buttonText:p="",stacked:f=!1}=e;if(f||["text","textarea","select"].includes(o)){let e;return e="textarea"===o?`<textarea id="${n}" placeholder="${s}">${i}</textarea>`:"select"===o&&l?`<select id="${n}">${l}</select>`:`<input type="${o}" id="${n}" value="${i}" placeholder="${s}">`,`\n\t\t\t<div class="${"nc-input-row-stacked"+(r?" "+r:"")}">\n\t\t\t\t${t?`<label for="${n}">${t}</label>`:""}\n\t\t\t\t${e}\n\t\t\t\t${a?`<div class="hint">${a}</div>`:""}\n\t\t\t</div>\n\t\t`}if("toggle"===o)return`\n\t\t\t<div class="${"nc-input-row nc-flex nc-items-center nc-justify-between nc-gap-4 nc-toggle"+(r?" "+r:"")}">\n\t\t\t\t<label>${t}</label>\n\t\t\t\t<label class="nc-toggle-label">\n\t\t\t\t\t<div class="nc-toggle-value">${c?"true":"false"}</div>\n\t\t\t\t\t<input type="checkbox" id="${n}" class="nc-sr-only" ${c?"checked":""} ${d?"disabled":""}>\n\t\t\t\t\t<div class="nc-toggle-track${c?" active":""}">\n\t\t\t\t\t\t<div class="nc-toggle-thumb ${c?"pos-end":"pos-start"}"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t`;if("tristate"===o){const e=!0===u;return`\n\t\t\t<div class="${"nc-input-row nc-flex nc-items-center nc-justify-between nc-gap-4 nc-toggle nc-tristate-toggle"+(r?" "+r:"")}">\n\t\t\t\t<label>${t}${g?` <span class="nc-text-dim">(default: ${g})</span>`:""}</label>\n\t\t\t\t<label class="nc-toggle-label">\n\t\t\t\t\t<div class="nc-toggle-value">${!0===u?"true":!1===u?"false":"auto"}</div>\n\t\t\t\t\t<input type="checkbox" id="${n}" class="nc-sr-only" ${e?"checked":""}>\n\t\t\t\t\t<div class="nc-toggle-track${e?" active":""}">\n\t\t\t\t\t\t<div class="nc-toggle-thumb ${!0===u?"pos-end":!1===u?"pos-start":"pos-middle"}"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t`}return"button"===o?`\n\t\t\t<div class="${"nc-input-row nc-flex nc-items-center nc-justify-between nc-gap-4"+(r?" "+r:"")}">\n\t\t\t\t<label>${t}</label>\n\t\t\t\t<button id="${n}" class="nc-inline-btn nc-flex-shrink-0">${p}</button>\n\t\t\t</div>\n\t\t`:""}function pe(e){x();const{title:t,content:n,buttons:o=[],width:i="400px",onClose:s,onSettings:a,preview:r=""}=e,l=document.createElement("div");l.className="nc-dialog-overlay",l.innerHTML=`\n\t\t<div class="nc-dialog" style="min-width: ${i}; max-width: calc(${i} + 100px);">\n\t\t\t<div class="nc-dialog-header nc-flex nc-justify-between">\n\t\t\t\t<h3>${t}</h3>\n\t\t\t\t<div class="spacer"></div>\n\t\t\t\t${a?'<button class="nc-header-settings link-brackets"><span class="inner">SETTINGS</span></button>':""}\n\t\t\t\t<button class="nc-header-close link-brackets"><span class="inner">ESC</span></button>\n\t\t\t</div>\n\t\t\t${r?`<div class="nc-dialog-preview">${r}</div>`:""}\n\t\t\t<div class="nc-dialog-content">\n\t\t\t\t${n}\n\t\t\t</div>\n\t\t\t<div class="nc-dialog-footer">\n\t\t\t\t<div class="nc-dialog-warning hint">\n\t\t\t\t\tThis is a custom userscript. Do NOT report issues to the creator of Cyberspace. Use the [SETTINGS] -> [REPORT ISSUE] button.\n\t\t\t\t</div>\n\t\t\t\t<div class="nc-dialog-attribution hint">\n\t\t\t\t\t<span>created by <a href="/z0ylent">@z0ylent</a></span>\n\t\t\t\t\t<span> | </span>\n\t\t\t\t\t<span><a href="https://z0m.bi" target="_blank">https://z0m.bi</a></span>\n\t\t\t\t\t<span> | </span>\n\t\t\t\t\t<span><a class="github-link" href="https://github.com/z0mbieparade/cyberspace-nick-colors" target="_blank" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" height="14px"> <path fill="currentColor" d="M5 2h4v2H7v2H5V2Zm0 10H3V6h2v6Zm2 2H5v-2h2v2Zm2 2v-2H7v2H3v-2H1v2h2v2h4v4h2v-4h2v-2H9Zm0 0v2H7v-2h2Zm6-12v2H9V4h6Zm4 2h-2V4h-2V2h4v4Zm0 6V6h2v6h-2Zm-2 2v-2h2v2h-2Zm-2 2v-2h2v2h-2Zm0 2h-2v-2h2v2Zm0 0h2v4h-2v-4Z"/> </svg></a></span>\n\t\t\t\t\t<span> | </span>\n\t\t\t\t\t<span>v1.1</span><br />\n\t\t\t\t</div>\n\t\t\t\t<hr />\n\t\t\t\t<div class="buttons nc-flex nc-flex-wrap nc-items-center nc-gap-2">\n\t\t\t\t\t${o.map(e=>`<button class="${e.class||""} link-brackets"><span class="inner">${e.label}</span></button>`).join("")}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`;const c=()=>{l.remove(),s?.()};o.forEach(e=>{const t=l.querySelector(`.nc-dialog-footer button.${e.class}`);t&&e.onClick&&t.addEventListener("click",()=>e.onClick(c))});const d=l.querySelector(".nc-header-close");d&&d.addEventListener("click",c);const u=l.querySelector(".nc-header-settings");return u&&a&&u.addEventListener("click",()=>{c(),a()}),l.addEventListener("click",e=>{e.target===l&&c()}),l.addEventListener("keydown",e=>{"Escape"===e.key&&c()}),l.setAttribute("tabindex","-1"),document.body.appendChild(l),l.focus(),{el:l,close:c,querySelector:e=>l.querySelector(e),querySelectorAll:e=>l.querySelectorAll(e)}}function fe(e){const{schema:t,values:n={},defaults:o={},onChange:i,container:s}=e,a={},r={};function l(e){if(!e)return!0;if(void 0!==e.field){const t=a[e.field];return!t||t.value===e.is}return e.any?e.any.some(e=>l(e)):!e.all||e.all.every(e=>l(e))}function c(e){const t=a[e];if(!t||!t.definition.showWhen)return;const n=l(t.definition.showWhen);t.wrapper&&(t.wrapper.style.display=n?"":"none")}function d(e){(r[e]||[]).forEach(e=>c(e))}function u(e,t){if(!t)return;const n=t=>{t.field&&(r[t.field]||(r[t.field]=[]),r[t.field].includes(e)||r[t.field].push(e)),t.any&&t.any.forEach(n),t.all&&t.all.forEach(n)};n(t)}function g(e,t,n=!0){const o=a[e];o&&(o.value=t,function(e,t){const n=a[e];if(!n)return;const{definition:o,element:i,slider:s}=n;switch(o.type){case"toggle":i&&(i.checked=!!t,function(e){const t=e.closest(".nc-toggle");if(!t)return;const n=e.checked,o=t.querySelector(".nc-toggle-value"),i=t.querySelector(".nc-toggle-track"),s=t.querySelector(".nc-toggle-thumb");o&&(o.textContent=n?"true":"false"),i&&i.classList.toggle("active",n),s&&(s.classList.toggle("pos-end",n),s.classList.toggle("pos-start",!n))}(i));break;case"tristate":i&&(i.dataset.tristateValue=null===t?"null":String(t),function(e,t){const n=e.closest(".nc-tristate-toggle");if(!n)return;const o=!0===t?"true":!1===t?"false":"auto",i=n.querySelector(".nc-toggle-value"),s=n.querySelector(".nc-toggle-track"),a=n.querySelector(".nc-toggle-thumb");i&&(i.textContent=o),s&&s.classList.toggle("active",!0===t),a&&(a.classList.remove("pos-start","pos-middle","pos-end"),a.classList.add(!0===t?"pos-end":!1===t?"pos-start":"pos-middle"))}(i,t));break;case"slider":s&&s.setValue(t);break;case"range":s&&s.setValues(t);break;case"text":case"textarea":case"select":i&&(i.value=t||"")}}(e,t),n&&(d(e),o.definition.onChange?.(t,h),i?.(e,t,h)))}function p(e,t){const{key:o,type:i,label:s,hint:r,showWhen:l}=e,c=document.createElement("div");c.className="nc-settings-field",o&&(c.dataset.fieldKey=o);const d=o?void 0!==n[o]?n[o]:e.default:void 0;let p=null,f=null;switch(i){case"toggle":c.innerHTML=ge({type:"toggle",label:e.label,id:`settings-${o}`,checked:!!d,disabled:"function"==typeof e.disabled?e.disabled(n):e.disabled}),p=c.querySelector(`#settings-${o}`),p&&p.addEventListener("change",()=>{g(o,p.checked)});break;case"tristate":c.innerHTML=ge({type:"tristate",label:e.label,id:`settings-${o}`,state:d,defaultLabel:e.defaultLabel||""}),p=c.querySelector(`#settings-${o}`),p&&(p.dataset.tristateValue=null===d?"null":String(d),p.addEventListener("click",e=>{e.preventDefault();const t=a[o].value;g(o,null===t||!0!==t&&null)}));break;case"slider":f=ue({type:"single",simple:!1!==e.simple,min:e.min??0,max:e.max??100,step:e.step??1,value:d??e.default??e.min??0,label:e.label,onChange:e=>g(o,e)}),c.appendChild(f.el);break;case"range":f=ue({type:"range",min:e.min??0,max:e.max??100,values:d??e.default??[e.min??0,e.max??100],label:e.label,onChange:e=>g(o,e)}),c.appendChild(f.el);break;case"text":c.innerHTML=ge({type:"text",label:e.label,id:`settings-${o}`,value:d||"",placeholder:e.placeholder||""}),p=c.querySelector(`#settings-${o}`),p&&p.addEventListener("input",()=>{g(o,p.value)});break;case"textarea":c.innerHTML=ge({type:"textarea",label:e.label,id:`settings-${o}`,value:d||"",placeholder:e.placeholder||""}),p=c.querySelector(`#settings-${o}`),p&&p.addEventListener("input",()=>{g(o,p.value)});break;case"select":{const t=e.options.map(e=>"string"==typeof e?`<option value="${e}">${e}</option>`:`<option value="${e.value}">${e.label}</option>`).join("");c.innerHTML=ge({type:"select",label:e.label,id:`settings-${o}`,options:t}),p=c.querySelector(`#settings-${o}`),p&&(p.value=d||"",p.addEventListener("change",()=>{g(o,p.value)}));break}case"button":c.innerHTML=ge({type:"button",label:e.label,id:`settings-${o||e.id}`,buttonText:e.buttonText||e.label}),p=c.querySelector(`#settings-${o||e.id}`),p&&e.onClick&&p.addEventListener("click",()=>e.onClick(h));break;case"custom":if(e.render){const t=e.render(d,h);t&&c.appendChild(t)}break;case"hint":c.innerHTML=`<div class="hint">${e.text||e.label}</div>`;break;case"hr":c.innerHTML="<hr />"}if(r&&"hint"!==i){const e=document.createElement("div");e.className="hint",e.innerHTML=r,c.appendChild(e)}return o&&(a[o]={value:d,element:p,slider:f,wrapper:c,definition:e},l&&u(o,l)),t.appendChild(c),c}function f(e,t){const n=document.createElement("div");n.className="nc-settings-section-wrapper";const o=document.createElement("div");if(o.className="nc-settings-section",e.label){const t=document.createElement("h4");t.innerHTML=e.label,o.appendChild(t)}if(e.hint){const t=document.createElement("div");t.className="hint",t.innerHTML=e.hint,o.appendChild(t)}e.fields&&e.fields.forEach(e=>{"section"===e.type?f(e,o):p(e,o)}),n.appendChild(o);const i=document.createElement("hr");if(n.appendChild(i),t.appendChild(n),e.showWhen){const t=`_section_${e.label||Math.random()}`;a[t]={value:null,element:null,slider:null,wrapper:n,definition:e},u(t,e.showWhen)}return n}function m(e,t=!1){Object.keys(e).forEach(n=>{a[n]&&g(n,e[n],t)}),Object.keys(a).forEach(e=>c(e))}const h={render:function(){s&&(t.forEach(e=>{"section"===e.type?f(e,s):p(e,s)}),Object.keys(a).forEach(e=>{c(e)}))},getValues:function(){const e={};return Object.keys(a).forEach(t=>{const n=a[t];n&&"button"!==n.definition.type&&(e[t]=n.value)}),e},setValues:m,reset:function(){const e={...o},n=t=>{t.forEach(t=>{"section"===t.type&&t.fields?n(t.fields):t.key&&void 0!==t.default&&void 0===e[t.key]&&(e[t.key]=t.default)})};n(t),m(e,!0)},getField:function(e){const t=a[e];return t?{element:t.element,wrapper:t.wrapper,getValue:()=>t.value,setValue:t=>g(e,t),setGradient:t.slider?.setGradient,setSplitGradient:t.slider?.setSplitGradient,setThumbColor:t.slider?.setThumbColor,setValues:t.slider?.setValues,getValues:t.slider?.getValues}:null},destroy:function(){s&&(s.innerHTML=""),Object.keys(a).forEach(e=>delete a[e]),Object.keys(r).forEach(e=>delete r[e])},fields:a,setFieldValue:g,getFieldValue:function(e){const t=a[e];if(t)return t.value},updateDependencies:d};return h}function me(){const e=v(),t=l(null,"hsl"),{settings:n,colorVariables:o}=c(),s=pe({title:"Nick Color Settings",width:"400px",preview:'<div class="preview-row" id="settings-preview"></div>\n\t\t\t<div class="preview-row preview-inverted" id="settings-preview-inverted"></div>',content:`\n\t\t\t${Y({"Site Theme":Object.entries(t).length?"<span>"+Object.entries(t).filter(([e,t])=>!e.match(/^info|error|warn|success/i)).map(([e,t])=>`${e}: ${i(t,"hsl-string")+` <span style="border: 1px solid var(--nc-border); color: ${i(t,"hsl-string")}">███</span>`}`).join("</span><br /><span>")+"</span>":"not detected","Effective Config":`H:${e.minHue}-${e.maxHue} S:${e.minSaturation}-${e.maxSaturation} L:${e.minLightness}-${e.maxLightness}`,"Contrast Threshold":e.contrastThreshold,"Custom Colors Saved":Object.keys(D).length})}\n\t\t\t${ge({label:"Preset Theme:",id:"settings-preset",type:"select",options:`<option value="">-- Select a preset --</option>${Object.keys(F).map(e=>`<option value="${e.toLowerCase()}">${e}</option>`).join("")}`})}\n\t\t\t<hr />\n\t\t\t<div id="settings-engine-container"></div>\n\t\t`,buttons:[{label:"Save",class:"save",onClick:e=>{j=f.getValues(),A(),S(),e()}},{label:"Reset",class:"reset",onClick:()=>{const e=r.value||H||"",t=c(e),n=t.settings,o=t.colorVariables;f.setValues({...n,hueRange:[n.minHue,n.maxHue],satRange:[n.minSaturation,n.maxSaturation],litRange:[n.minLightness,n.maxLightness],singleColorHue:o.fg?.h??n.singleColorHue,singleColorSat:o.fg?.s??n.singleColorSat,singleColorLit:o.fg?.l??n.singleColorLit},!0),r.value=e.toLowerCase(),y()}},{label:"Cancel",class:"cancel",onClick:e=>e()}]}),a=s.querySelector("#settings-engine-container"),r=s.querySelector("#settings-preset"),d=s.querySelector("#settings-preview"),u=s.querySelector("#settings-preview-inverted"),g=["z0ylent","fr33Kevin","triNity","an0nym0us","ZeR0C00L","l1sb3th","enki","genghis_khan","acidBurn","neo","N3tRuNn3r","ByteMe99","CyB3rPuNk"];g.forEach(e=>{const t=document.createElement("span");t.className="preview-nick",t.textContent=e,d.appendChild(t)}),g.forEach(e=>{const t=document.createElement("span");t.className="preview-nick",t.textContent=e,u.appendChild(t)});const p=[{type:"section",label:"Color Mode",fields:[{key:"useSingleColor",type:"toggle",label:"Use single color for all nicks",default:!1},{type:"hint",text:"All usernames will use the same color. Per-user color customization is disabled.",showWhen:{field:"useSingleColor",is:!0}},{key:"singleColorHue",type:"slider",label:"Hue",min:0,max:360,default:o.fg?.h??180,simple:!1,showWhen:{field:"useSingleColor",is:!0}},{key:"singleColorSat",type:"slider",label:"Saturation",min:0,max:100,default:o.fg?.s??85,simple:!1,showWhen:{field:"useSingleColor",is:!0}},{key:"singleColorLit",type:"slider",label:"Lightness",min:0,max:100,default:o.fg?.l??65,simple:!1,showWhen:{field:"useSingleColor",is:!0}},{key:"singleColorCustom",type:"text",label:"Or use a custom color:",placeholder:"#ff6b6b or hsl(280, 90%, 65%)",default:"",showWhen:{field:"useSingleColor",is:!0}}]},{type:"section",label:"Hue Range"+(t.fg?"":' <span class="nc-text-dim">(no site theme)</span>'),showWhen:{field:"useSingleColor",is:!1},fields:[{key:"useSiteThemeHue",type:"toggle",label:"Use site theme foreground hue"+(t.fg?` <span style="color:hsl(${t.fg.h}, 100%, 50%)">(${t.fg.h}°)</span>`:""),default:!1,disabled:!t.fg,showWhen:{field:"useSingleColor",is:!1}},{key:"hueSpread",type:"slider",label:"Hue spread (±°)",min:5,max:180,default:30,showWhen:{all:[{field:"useSingleColor",is:!1},{field:"useSiteThemeHue",is:!0}]}},{key:"hueRange",type:"range",label:"Hue Range",min:0,max:360,default:[0,360],showWhen:{field:"useSingleColor",is:!1}}]},{type:"section",label:"Saturation Range",showWhen:{field:"useSingleColor",is:!1},fields:[{key:"useSiteThemeSat",type:"toggle",label:"Use site theme foreground saturation"+(t?.fg?` <span style="color:${t.fg}">(${t.fg.s}%)</span>`:""),default:!1,disabled:!t.fg,showWhen:{field:"useSingleColor",is:!1}},{key:"satSpread",type:"slider",label:"Saturation spread (±%)",min:0,max:50,default:15,showWhen:{all:[{field:"useSingleColor",is:!1},{field:"useSiteThemeSat",is:!0}]}},{key:"satRange",type:"range",label:"Saturation Range",min:0,max:100,default:[70,100],showWhen:{field:"useSingleColor",is:!1}}]},{type:"section",label:"Lightness Range",showWhen:{field:"useSingleColor",is:!1},fields:[{key:"useSiteThemeLit",type:"toggle",label:"Use site theme foreground lightness"+(t?.fg?` <span style="color:${t.fg}">(${t.fg.l}%)</span>`:""),default:!1,disabled:!t.fg,showWhen:{field:"useSingleColor",is:!1}},{key:"litSpread",type:"slider",label:"Lightness spread (±%)",min:0,max:50,default:10,showWhen:{all:[{field:"useSingleColor",is:!1},{field:"useSiteThemeLit",is:!0}]}},{key:"litRange",type:"range",label:"Lightness Range",min:0,max:100,default:[55,75],showWhen:{field:"useSingleColor",is:!1}}]},{type:"section",label:"Contrast",fields:[{type:"hint",text:"Auto-invert colors when WCAG contrast ratio is below threshold (0 = disabled, 3 = large text, 4.5 = AA, 7 = AAA)"},{key:"contrastThreshold",type:"slider",label:"Contrast Threshold (WCAG ratio)",min:0,max:21,step:.5,default:4.5}]},{type:"section",label:"Style Variation",fields:[{type:"hint",text:"Add non-color variation to usernames (useful for limited color ranges)"},{key:"varyWeight",type:"toggle",label:"Vary font weight",default:!1},{key:"varyItalic",type:"toggle",label:"Vary italic",default:!1},{key:"varyCase",type:"toggle",label:"Vary small-caps",default:!1},{key:"prependIcon",type:"toggle",label:"Prepend icon",default:!1},{key:"appendIcon",type:"toggle",label:"Append icon",default:!1},{key:"iconSet",type:"text",label:"Icon set (space-separated)",placeholder:"● ○ ◆ ◇ ■ □ ▲ △ ★ ☆",default:"● ○ ◆ ◇ ■ □ ▲ △ ★ ☆ ♦ ♠ ♣ ♥ ☢ ☣ ☠ ⚙ ⬡ ⬢ ♻ ⚛ ⚠ ⛒",showWhen:{any:[{field:"prependIcon",is:!0},{field:"appendIcon",is:!0}]}}]},{type:"section",label:"Backup",fields:[{type:"button",label:"Export settings to file",id:"settings-export-file",buttonText:"Save Settings File",onClick:()=>{J(W(),`nick-colors-settings-${(new Date).toISOString().slice(0,10)}.json`)}},{type:"button",label:"Export settings to clipboard",id:"settings-export-copy",buttonText:"Copy to Clipboard",onClick:async()=>{try{await U(W()),alert("Settings copied to clipboard")}catch(e){alert(e.message)}}},{type:"button",label:"Import settings from file",id:"settings-import-file",buttonText:"Load Settings File",onClick:()=>{Z((e,t)=>{if(t)return void alert(t.message);const n=z(e);if(alert(n.message),n.success){const e=document.querySelector(".nc-dialog-overlay");e&&(e.remove(),me())}})}},{type:"button",label:"Import settings from clipboard",id:"settings-import-paste",buttonText:"Paste from Clipboard",onClick:()=>{X((e,t)=>{if(t)return void alert(t.message);const n=z(e);if(alert(n.message),n.success){const e=document.querySelector(".nc-dialog-overlay");e&&(e.remove(),me())}})}}]},{type:"section",label:"Debug",fields:[{key:"debugMode",type:"toggle",label:"Enable debug mode",default:C,onChange:e=>{C=e,GM_setValue("debugMode",C?"true":"false")}},{type:"button",label:"Export debug log to file",id:"settings-debug-export-file",buttonText:"Save Debug File",onClick:()=>{!function(e,t){const n=new Blob([e],{type:"text/plain"}),o=URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}(ee(),`nick-colors-debug-${(new Date).toISOString().slice(0,10)}.txt`)}},{type:"button",label:"Export debug log to clipboard",id:"settings-debug-export-copy",buttonText:"Copy to Clipboard",onClick:async()=>{try{await navigator.clipboard.writeText(ee()),alert("Debug log copied to clipboard")}catch(e){alert(`Failed to copy: ${e.message}`)}}},{type:"button",label:"Report an issue",id:"settings-report-issue",buttonText:"Report Issue",onClick:()=>function(){const e=document.createElement("div");e.className="nc-dialog-overlay",e.innerHTML='\n\t\t<div class="nc-dialog" style="min-width: 400px; max-width: 500px;">\n\t\t\t<div class="nc-dialog-header nc-flex nc-justify-between">\n\t\t\t\t<h3>Report Issue</h3>\n\t\t\t\t<div class="spacer"></div>\n\t\t\t\t<button class="nc-header-close link-brackets"><span class="inner">ESC</span></button>\n\t\t\t</div>\n\t\t\t<div class="nc-dialog-content">\n\t\t\t\t<div class="hint">Fill out the fields below to report an issue. All fields are required.</div>\n\t\t\t\t<div class="nc-input-row">\n\t\t\t\t\t<label for="report-issue">What issue are you experiencing?</label>\n\t\t\t\t\t<textarea id="report-issue" placeholder="Describe the problem..." style="width: 100%; min-height: 60px;"></textarea>\n\t\t\t\t</div>\n\t\t\t\t<div class="nc-input-row">\n\t\t\t\t\t<label for="report-steps">Steps to reproduce:</label>\n\t\t\t\t\t<textarea id="report-steps" placeholder="1. Go to...\n2. Click on...\n3. See error..." style="width: 100%; min-height: 60px;"></textarea>\n\t\t\t\t</div>\n\t\t\t\t<div class="nc-input-row">\n\t\t\t\t\t<label for="report-errors">Any error messages? (check browser console)</label>\n\t\t\t\t\t<input type="text" id="report-errors" placeholder="Optional - paste any errors" style="width: 100%;">\n\t\t\t\t</div>\n\t\t\t\t<div class="hint">Debug info will be automatically included.</div>\n\t\t\t</div>\n\t\t\t<div class="nc-dialog-footer">\n\t\t\t\t<div class="buttons nc-flex nc-items-center nc-gap-2">\n\t\t\t\t\t<button class="nc-submit-report-btn link-brackets"><span class="inner">SEND REPORT</span></button>\n\t\t\t\t\t<button class="nc-cancel-btn link-brackets"><span class="inner">CANCEL</span></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t';const t=()=>e.remove(),n=e.querySelector("#report-issue"),o=e.querySelector("#report-steps"),i=e.querySelector("#report-errors");e.querySelector(".nc-header-close").addEventListener("click",t),e.querySelector(".nc-cancel-btn").addEventListener("click",t),e.querySelector(".nc-submit-report-btn").addEventListener("click",()=>{const e=n.value.trim(),s=o.value.trim(),a=i.value.trim();if(!e)return alert("Please describe the issue"),void n.focus();if(!s)return alert("Please provide steps to reproduce"),void o.focus();const r=v(),l=`v1.1 | ${Object.keys(D).length} custom | H:${r.minHue}-${r.maxHue} S:${r.minSaturation}-${r.maxSaturation} L:${r.minLightness}-${r.maxLightness}`,c={siteConfig:j,style:j};let d=`[Nick Colors Issue Report]| Issue: ${e} | Steps: ${s}`;a&&(d+=` | Errors: ${a}`),d+=` | Debug: ${l} | Page: ${window.location.href} | Settings: ${JSON.stringify(P(c))}`,t(),K("z0ylent",d)}),e.addEventListener("click",n=>{n.target===e&&t()}),e.addEventListener("keydown",e=>{"Escape"===e.key&&t()}),document.body.appendChild(e),usernameInput.focus()}()}]}],f=fe({schema:p,values:{...e,hueRange:[e.minHue,e.maxHue],satRange:[e.minSaturation,e.maxSaturation],litRange:[e.minLightness,e.maxLightness],debugMode:C},defaults:n,onChange:(e,t)=>{"useSiteThemeHue"!==e&&"hueSpread"!==e||m("hue"),"useSiteThemeSat"!==e&&"satSpread"!==e||m("sat"),"useSiteThemeLit"!==e&&"litSpread"!==e||m("lit"),b(),y()},container:a});function m(e){if(!t.fg)return;if(!f.getFieldValue(`useSiteTheme${e.charAt(0).toUpperCase()+e.slice(1)}`))return;const n=f.getFieldValue(`${e}Spread`),o=f.getField(`${e}Range`);if("hue"===e){const e=(t.fg.h-n+360)%360,i=(t.fg.h+n)%360;o?.setValues([e,i])}else if("sat"===e){const e=Math.max(0,t.fg.s-n),i=Math.min(100,t.fg.s+n);o?.setValues([e,i])}else if("lit"===e){const e=Math.max(0,t.fg.l-n),i=Math.min(100,t.fg.l+n);o?.setValues([e,i])}}function h(e,t){const n=f.getField(e);n?.wrapper&&(n.wrapper.style.pointerEvents=t?"none":"auto",n.wrapper.querySelectorAll(".nc-slider-thumb").forEach(e=>{e.style.background=t?"var(--nc-fg-dim)":"",e.style.cursor=t?"default":""}))}function b(){const e=f.getField("hueRange"),t=f.getField("satRange"),n=f.getField("litRange"),o=f.getField("singleColorHue"),i=f.getField("singleColorSat"),s=f.getField("singleColorLit");if(!e||!t||!n)return;const[a,r]=e.getValues?.()||[0,360],[l,c]=t.getValues?.()||[70,100],[d,u]=n.getValues?.()||[55,75],g=(a+r)/2,p=(l+c)/2,m=(d+u)/2,b=Array.from({length:13},(e,t)=>[30*t,p,m,1,30*t/360*100]);if(e.setGradient?.(b),t.setGradient?.([[g,0,m,1,0],[g,100,m,1,100]]),n.setGradient?.([[g,p,0,1,0],[g,p,50,1,50],[g,p,100,1,100]]),e.setThumbColor?.([`hsl(${a}, ${p}%, ${m}%)`,`hsl(${r}, ${p}%, ${m}%)`]),t.setThumbColor?.([`hsl(${g}, ${l}%, ${m}%)`,`hsl(${g}, ${c}%, ${m}%)`]),n.setThumbColor?.([`hsl(${g}, ${p}%, ${d}%)`,`hsl(${g}, ${p}%, ${u}%)`]),o&&i&&s){const e=o.getValue?.()??180,t=i.getValue?.()??85,n=s.getValue?.()??65,a=Array.from({length:13},(e,o)=>{const i=30*o;return[i,t,n,1,i/360*100]});o.setGradient?.(a),i.setGradient?.([[e,0,n,1,0],[e,100,n,1,100]]),s.setGradient?.([[e,t,0,1,0],[e,t,50,1,50],[e,t,100,1,100]])}h("hueRange",f.getFieldValue("useSiteThemeHue")),h("satRange",f.getFieldValue("useSiteThemeSat")),h("litRange",f.getFieldValue("useSiteThemeLit"))}function y(){b();const e=function(){const e=f.getValues(),t={...e};return e.hueRange&&(t.minHue=e.hueRange[0],t.maxHue=e.hueRange[1]),e.satRange&&(t.minSaturation=e.satRange[0],t.maxSaturation=e.satRange[1]),e.litRange&&(t.minLightness=e.litRange[0],t.maxLightness=e.litRange[1]),t}();d.querySelectorAll(".preview-nick").forEach((t,n)=>{se(t,g[n],{effectiveConfig:e,isInverted:!1,debugData:C})}),u.querySelectorAll(".preview-nick").forEach((t,n)=>{se(t,g[n],{effectiveConfig:e,isInverted:!0,debugData:C})})}f.render(),r.addEventListener("change",()=>{const e=c(r.value);if(e?.settings){const t=e.settings;f.setValues({hueRange:[t.minHue,t.maxHue],satRange:[t.minSaturation,t.maxSaturation],litRange:[t.minLightness,t.maxLightness],contrastThreshold:t.contrastThreshold||4.5},!0),y()}});const x=f.getValues.bind(f);f.getValues=()=>{const e=x(),t={...e};return e.hueRange&&(t.minHue=e.hueRange[0],t.maxHue=e.hueRange[1],delete t.hueRange),e.satRange&&(t.minSaturation=e.satRange[0],t.maxSaturation=e.satRange[1],delete t.satRange),e.litRange&&(t.minLightness=e.litRange[0],t.maxLightness=e.litRange[1],delete t.litRange),delete t.debugMode,t},m("hue"),m("sat"),m("lit"),y()}document.addEventListener("contextmenu",e=>{const t=e.target.closest("[data-nick-colored], [data-mention-colored]");t&&t.dataset.username&&(e.preventDefault(),function(e,t){const n=v(),o=["color","icon","fontWeight","fontStyle","fontVariant","invert"],s=p(Object.fromEntries(Object.entries(te(t)).filter(([e])=>!o.includes(e))),";\n"),a=D[e]||{},r=a.prependIcon??"",l=a.appendIcon??"",c="prependIcon"in a?!!r:null,d="appendIcon"in a?!!l:null,u=oe(e,{effectiveConfig:n})||"",h=ie(e),x=h.fontWeight,k=h.fontStyle,w=h.fontVariant,L=D[e]||{},E=L.fontWeight,T=L.fontStyle,I=L.fontVariant,N=L.invert,F=$[e];let V="";if(F){const t=$[e];V="string"==typeof t?`color: ${t}`:p(t)}const H=0!==n.minHue||360!==n.maxHue,M=0!==n.minSaturation||100!==n.maxSaturation,R=0!==n.minLightness||100!==n.maxLightness,O=H||M||R,A=ne(e,"hsl",{effectiveConfig:n}),W=b(A,"hsl",{effectiveConfig:n});let z="hash-generated",B="";D[e]?(z="customNickColors (local save)",B=JSON.stringify(D[e])):$[e]&&(z="MANUAL_OVERRIDES (remote)",B=JSON.stringify($[e]));const G=y(e),_=y(e+"_sat"),ee=y(e+"_lit"),ae=y(e+"_style"),re=e=>j.iconSet?`<div class="picker-icon-options" data-target="${e}" style="display: flex; flex-wrap: wrap; gap: 0.25em; margin-bottom: 0.5rem;">${j.iconSet.split(/\s+/).filter(Boolean).map(e=>`<span class="nc-icon-option" style="cursor: pointer; padding: 0.2em 0.4em; border: 1px solid var(--nc-border); border-radius: var(--radius-md); transition: background 0.15s, border-color 0.15s;" title="Click to select">${e}</span>`).join("")}</div>`:"",le=pe({title:`Nick: ${e}`,width:"350px",onSettings:()=>me(),preview:`<div class="preview">&lt;<span id="picker-preview">${e}</span>&gt; Example chat message in cIRC<br />Inline mention in plain text <span id="picker-preview-mention">@${e}</span> example</div>\n\t\t\t<div class="preview preview-inverted" id="picker-preview-inverted">&lt;<span id="picker-preview-inverted-nick">${e}</span>&gt; Inverted container preview</div>`,content:`\n\t\t\t${Y({"Color Source":z,"Saved Data":B,"Hash Values":`h:${G} s:${_} l:${ee} style:${ae}`,"Base Color (raw)":{txt:`H:${A.h.toFixed(1)} S:${A.s.toFixed(1)} L:${A.l.toFixed(1)}`,elem:`<span class="nc-debug-color" style="background-color: hsl(${A.h}, ${A.s}%, ${A.l}%)">BASE</span>`},"Mapped Color":{txt:`H:${W.h.toFixed(1)} S:${W.s.toFixed(1)} L:${W.l.toFixed(1)}`,elem:`<span class="nc-debug-color" style="background-color: hsl(${W.h}, ${W.s}%, ${W.l}%)">MAPPED</span>`},"Effective Config":{txt:`H:${n.minHue}-${n.maxHue} S:${n.minSaturation}-${n.maxSaturation} L:${n.minLightness}-${n.maxLightness}`,elem:`<span class="nc-debug-color" style="background-color: hsl(${n.minHue}, ${n.minSaturation}%, ${n.minLightness}%)">MIN</span>-<span class="nc-debug-color" style="background-color: hsl(${n.maxHue}, ${n.maxSaturation}%, ${n.maxLightness}%)">MAX</span>`},"Style Variations":`weight:${x} italic:${k} case:${w}`})}\n\t\t\t${F?`<div class="hint">Site-wide override: <code style="background: var(--nc-code-bg); padding: 0.1em 0.3em;">${V}</code><br>Your changes will override this locally.</div>`:""}\n\t\t\t${n.useSingleColor?'\n\t\t\t<div class="nc-dialog-info" style="padding: 0.5rem;">\n\t\t\t\tPer-user color customization is disabled. All nicks use a single color.<br>\n\t\t\t\t<button class="link-brackets" id="picker-open-settings" style="margin-top: 0.5rem;"><span class="inner">Change in Settings</span></button>\n\t\t\t</div>\n\t\t\t':`\n\t\t\t<h4>Nick Color</h4>\n\t\t\t<div id="picker-sliders"></div>\n\t\t\t${ge({label:"Custom color value:",id:"picker-custom",placeholder:"#ff6b6b or hsl(280, 90%, 65%)",classes:"no-padding-bottom"})}\n\t\t\t${O?'<div class="hint">Color range is restricted. Preview shows mapped result. Click SETTINGS to adjust.</div>':""}\n\t\t\t`}\n\t\t\t<div id="picker-engine-container"></div>\n\t\t`,buttons:[{label:"Save",class:"save",onClick:t=>{const n=we(),o={...g(xe.getFieldValue("customCss")||"")};n&&(o.color=n);const i=xe.getFieldValue("prependIconEnabled");!0===i?o.prependIcon=xe.getFieldValue("prependIcon")?.trim()||"":!1===i&&(o.prependIcon="");const s=xe.getFieldValue("appendIconEnabled");!0===s?o.appendIcon=xe.getFieldValue("appendIcon")?.trim()||"":!1===s&&(o.appendIcon="");const a=xe.getFieldValue("fontWeight"),r=xe.getFieldValue("fontStyle"),l=xe.getFieldValue("fontVariant"),c=xe.getFieldValue("invert");null!==a&&(o.fontWeight=a?"bold":"normal"),null!==r&&(o.fontStyle=r?"italic":"normal"),null!==l&&(o.fontVariant=l?"small-caps":"normal"),null!==c&&(o.invert=c),D[e]=o,q(),S(),t()}},{label:"Reset",class:"reset",onClick:t=>{delete D[e],q(),S(),t()}},{label:"Cancel",class:"cancel",onClick:e=>e()}]}),ce=le.querySelector("#picker-preview"),de=le.querySelector("#picker-preview-mention"),he=le.querySelector("#picker-preview-inverted-nick"),be=le.querySelector("#picker-custom"),ve=le.querySelector("#picker-sliders"),ye=le.querySelector("#picker-engine-container"),xe=fe({schema:[{type:"hr"},{type:"section",label:"Custom Icons",hint:"Prepend/Append a custom character or emoji to the nickname.",fields:[{key:"prependIconEnabled",type:"tristate",label:"Prepend icon",default:c,defaultLabel:u},{key:"prependIconPicker",type:"custom",showWhen:{field:"prependIconEnabled",is:!0},render:()=>{const e=document.createElement("div");return e.innerHTML=re("settings-prependIcon"),e}},{key:"prependIcon",type:"text",label:"",default:r,placeholder:"custom icon before nickname",showWhen:{field:"prependIconEnabled",is:!0}},{key:"appendIconEnabled",type:"tristate",label:"Append icon",default:d,defaultLabel:u},{key:"appendIconPicker",type:"custom",showWhen:{field:"appendIconEnabled",is:!0},render:()=>{const e=document.createElement("div");return e.innerHTML=re("settings-appendIcon"),e}},{key:"appendIcon",type:"text",label:"",default:l,placeholder:"custom icon after nickname",showWhen:{field:"appendIconEnabled",is:!0}}]},{type:"section",label:"Style Variations",hint:"Override the global style settings for this user to add some visual flair.",fields:[{key:"fontWeight",type:"tristate",label:"Bold",default:"bold"===E||"normal"!==E&&null,defaultLabel:x},{key:"fontStyle",type:"tristate",label:"Italic",default:"italic"===T||"normal"!==T&&null,defaultLabel:k},{key:"fontVariant",type:"tristate",label:"Small Caps",default:"small-caps"===I||"normal"!==I&&null,defaultLabel:w},{key:"invert",type:"tristate",label:"Invert",default:!0===N||!1!==N&&null,defaultLabel:"auto"}]},{type:"section",label:"Additional CSS",fields:[{key:"customCss",type:"textarea",label:"",default:s,placeholder:"background-color: #1a1a2e;\ntext-decoration: underline;",hint:"CSS properties, one per line"}]},{type:"section",label:"Backup",fields:[{key:"exportFile",type:"button",label:"Export user settings to file",buttonText:"Save Settings File",onClick:()=>{const t={[e]:Ee()},n=(new Date).toISOString().slice(0,10);J(t,`nick-colors-${e}-${n}.json`)}},{key:"exportCopy",type:"button",label:"Export user settings to clipboard",buttonText:"Copy to Clipboard",onClick:async()=>{const t={[e]:Ee()};try{await U(t),alert("Copied to clipboard!")}catch(e){alert(e.message)}}},{key:"importFile",type:"button",label:"Import user settings from file",buttonText:"Load Settings File",onClick:()=>{Z((t,n)=>{if(n)return void alert(n.message);const o=t[e]||Object.values(t)[0];o?(Te(o),alert("Settings imported!")):alert("No valid user settings found in file")})}},{key:"importPaste",type:"button",label:"Import user settings from clipboard",buttonText:"Paste from Clipboard",onClick:()=>{X((t,n)=>{if(n)return void alert(n.message);const o=t[e]||Object.values(t)[0];o?(Te(o),alert("Settings imported!")):alert("No valid user settings found in clipboard")})}}]},{type:"section",label:"Request Override",hint:"If you want your nickname to show up the same for everyone using the Nick Colors script, you can request an override. If the button below doesn't work, you can click 'Copy to Clipboard' above, and send it manually to <a href=\"/z0ylent\">@z0ylent</a>.",fields:[{key:"requestOverride",type:"button",label:"Message @z0ylent to request override",buttonText:"Request Override",onClick:()=>{const t={[e]:Ee()};K("z0ylent",`Hi! I'd like to request a site-wide nick color override: ${JSON.stringify(P(t))}`)}}]}],values:{},onChange:()=>Le(),container:ye});xe.render();let Se=null,Ce=null,ke=null;if(ve&&!n.useSingleColor){const e=H?`Hue <span class="nc-slider-values"></span> <span>→ mapped to ${n.minHue}-${n.maxHue}</span>`:'Hue <span class="nc-slider-values"></span>',t=M?`Sat <span class="nc-slider-values"></span> <span>→ mapped to ${n.minSaturation}-${n.maxSaturation}</span>`:'Sat <span class="nc-slider-values"></span>',o=R?`Lit <span class="nc-slider-values"></span> <span>→ mapped to ${n.minLightness}-${n.maxLightness}</span>`:'Lit <span class="nc-slider-values"></span>';Se=ue({label:e,min:0,max:360,value:180,onChange:()=>{be.value="",Le()}}),Ce=ue({label:t,min:0,max:100,value:85,onChange:()=>{be.value="",Le()}}),ke=ue({label:o,min:0,max:100,value:65,onChange:()=>{be.value="",Le()}}),ve.append(Se.el,Ce.el,ke.el)}const $e=le.querySelector("#picker-open-settings");function we(){return n.useSingleColor||!Se?be?.value?.trim()||null:be.value.trim()||`hsl(${Se.getValue()}, ${Ce.getValue()}%, ${ke.getValue()}%)`}function Le(){!function(){if(!Se||!Ce||!ke)return;const e=Se.getValue(),t=Ce.getValue(),o=ke.getValue(),i=f(e,n.minHue,n.maxHue),s=m(t,n.minSaturation,n.maxSaturation),a=m(o,n.minLightness,n.maxLightness),r=Array.from({length:13},(e,n)=>{const i=30*n;return[i,t,o,1,i/360*100]});if(H){const e=[];for(let t=0;t<=36;t++){const o=10*t,i=f(o,n.minHue,n.maxHue),r=o/360*100;e.push([i,s,a,1,r])}Se.setSplitGradient(e,r)}else Se.setSplitGradient(null),Se.setGradient(r);const l=[[e,0,o,1,0],[e,100,o,1,100]];if(M){const e=[[i,n.minSaturation,a,1,0],[i,n.maxSaturation,a,1,100]];Ce.setSplitGradient(e,l)}else Ce.setSplitGradient(null),Ce.setGradient(l);const c=[[e,t,0,1,0],[e,t,50,1,50],[e,t,100,1,100]];if(R){const e=[[i,s,n.minLightness,1,0],[i,s,n.maxLightness,1,100]];ke.setSplitGradient(e,c)}else ke.setSplitGradient(null),ke.setGradient(c);const d=`hsl(${i}, ${s}%, ${a}%)`;Se.setThumbColor(d),Ce.setThumbColor(d),ke.setThumbColor(d);const u=Se.el.querySelector(".nc-slider-values"),g=Ce.el.querySelector(".nc-slider-values"),p=ke.el.querySelector(".nc-slider-values");u&&(u.textContent=`[${Math.round(e)} → ${Math.round(i)}]`),g&&(g.textContent=`[${Math.round(t)} → ${Math.round(s)}]`),p&&(p.textContent=`[${Math.round(o)} → ${Math.round(a)}]`);const h=Q(Se.el),b=Q(Ce.el),v=Q(ke.el),y=n.maxHue-n.minHue,x=e/360;h.textContent=`t=${x.toFixed(3)} | ${n.minHue} + ${x.toFixed(3)} * (${n.maxHue} - ${n.minHue}) = ${n.minHue} + ${x.toFixed(3)} * ${y} = ${(n.minHue+x*y).toFixed(1)}`;const S=n.maxSaturation-n.minSaturation,C=t/100;b.textContent=`t=${C.toFixed(3)} | ${n.minSaturation} + ${C.toFixed(3)} * (${n.maxSaturation} - ${n.minSaturation}) = ${(n.minSaturation+C*S).toFixed(1)}`;const k=n.maxLightness-n.minLightness,$=o/100;v.textContent=`t=${$.toFixed(3)} | ${n.minLightness} + ${$.toFixed(3)} * (${n.maxLightness} - ${n.minLightness}) = ${(n.minLightness+$*k).toFixed(1)}`}();const t=we(),o=xe.getFieldValue("prependIconEnabled"),i=xe.getFieldValue("appendIconEnabled"),s=xe.getFieldValue("fontWeight"),a=xe.getFieldValue("fontStyle"),r=xe.getFieldValue("fontVariant"),l=xe.getFieldValue("invert"),c={...g(xe.getFieldValue("customCss")||"")};t&&(c.color=t),!0===o?c.prependIcon=(xe.getFieldValue("prependIcon")||"").trim():!1===o&&(c.prependIcon=""),!0===i?c.appendIcon=(xe.getFieldValue("appendIcon")||"").trim():!1===i&&(c.appendIcon=""),null!==s&&(c.fontWeight=s?"bold":"normal"),null!==a&&(c.fontStyle=a?"italic":"normal"),null!==r&&(c.fontVariant=r?"small-caps":"normal"),null!==l&&(c.invert=l);const d=D[e];D[e]=c;const p={...j};Object.assign(j,n),j.useSiteThemeHue=!1,j.useSiteThemeSat=!1,j.useSiteThemeLit=!1;let h="",b="";!0===o?h=(xe.getFieldValue("prependIcon")||"").trim():null===o&&j.prependIcon&&(h=u),!0===i?b=(xe.getFieldValue("appendIcon")||"").trim():null===i&&j.appendIcon&&(b=u);const v=(t,n,o=!1)=>{t.style.cssText="",se(t,e,{matchType:n?"mention":"nick",isInverted:o,debugData:C,mergeStyles:{prependIcon:h,appendIcon:b}})};v(ce,!1,!1),de&&v(de,!0,!1),he&&v(he,!1,!0),Object.assign(j,p),void 0!==d?D[e]=d:delete D[e]}if($e&&$e.addEventListener("click",()=>{le.closest(".nc-dialog-overlay")?.remove(),me()}),t.color&&Se&&Ce&&ke){const e=i(t.color,"hsl");e?(Se.setValue(e.h),Ce.setValue(e.s),ke.setValue(e.l)):be&&(be.value=t.color)}function Ee(){const e=we(),t=xe.getFieldValue("prependIconEnabled"),n=xe.getFieldValue("appendIconEnabled"),o=xe.getFieldValue("fontWeight"),i=xe.getFieldValue("fontStyle"),s=xe.getFieldValue("fontVariant"),a=xe.getFieldValue("invert"),r={...g(xe.getFieldValue("customCss")||"")};return e&&(r.color=e),!0===t?r.prependIcon=(xe.getFieldValue("prependIcon")||"").trim():!1===t&&(r.prependIcon=""),!0===n?r.appendIcon=(xe.getFieldValue("appendIcon")||"").trim():!1===n&&(r.appendIcon=""),null!==o&&(r.fontWeight=o?"bold":"normal"),null!==i&&(r.fontStyle=i?"italic":"normal"),null!==s&&(r.fontVariant=s?"small-caps":"normal"),null!==a&&(r.invert=a),r}function Te(e){if(e.color&&Se&&Ce&&ke){const t=i(e.color,"hsl");t?(Se.setValue(t.h),Ce.setValue(t.s),ke.setValue(t.l)):be&&(be.value=e.color)}const t=[];if(e.backgroundColor&&t.push(`background-color: ${e.backgroundColor}`),t.length>0&&xe.setFieldValue("customCss",t.join(";\n")),void 0!==e.prependIcon&&(""===e.prependIcon?xe.setFieldValue("prependIconEnabled",!1):(xe.setFieldValue("prependIconEnabled",!0),xe.setFieldValue("prependIcon",e.prependIcon))),void 0!==e.appendIcon&&(""===e.appendIcon?xe.setFieldValue("appendIconEnabled",!1):(xe.setFieldValue("appendIconEnabled",!0),xe.setFieldValue("appendIcon",e.appendIcon))),void 0!==e.fontWeight){const t="bold"===e.fontWeight||"normal"!==e.fontWeight&&null;xe.setFieldValue("fontWeight",t)}if(void 0!==e.fontStyle){const t="italic"===e.fontStyle||"normal"!==e.fontStyle&&null;xe.setFieldValue("fontStyle",t)}if(void 0!==e.fontVariant){const t="small-caps"===e.fontVariant||"normal"!==e.fontVariant&&null;xe.setFieldValue("fontVariant",t)}void 0!==e.invert&&xe.setFieldValue("invert",e.invert),Le()}be&&be.addEventListener("input",Le),ye.addEventListener("click",e=>{const t=e.target.closest(".nc-icon-option");if(t){const e=t.textContent,n=t.closest(".picker-icon-options"),o=n?.dataset.target;if(o){const t="settings-prependIcon"===o?"prependIcon":"appendIcon";xe.setFieldValue(t,e),Le()}t.style.background="var(--nc-fg-dim)",setTimeout(()=>{t.style.background=""},150)}}),Le()}(t.dataset.username,function(e){const t=ne(e);let n={color:`hsl(${t.h}, ${t.s}%, ${t.l}%)`};if(D[e]&&"object"==typeof D[e]){const t={...D[e]};delete t.color,delete t.invert,n={...n,...t}}else if($[e]&&"object"==typeof $[e]){const t={...$[e]};delete t.color,n={...n,...t}}return n}(t.dataset.username)))});const he="function"==typeof GM_registerMenuCommand?GM_registerMenuCommand:"undefined"!=typeof GM&&"function"==typeof GM.registerMenuCommand?GM.registerMenuCommand:null;he&&(he("Nick Colors Settings",me),he("Refresh Nick Colors",S),he("Clear All Custom Colors",()=>{confirm("Clear all custom color overrides?")&&(D={},q(),S())})),x(),new Promise(e=>{"undefined"!=typeof GM_xmlhttpRequest?GM_xmlhttpRequest({method:"GET",url:k,onload:t=>{try{const e=JSON.parse(t.responseText);$={...e,...$},console.log("[Nick Colors] Loaded remote overrides:",Object.keys(e).length)}catch(e){console.error("[Nick Colors] Failed to parse remote overrides:",e)}e()},onerror:t=>{console.error("[Nick Colors] Failed to fetch remote overrides:",t),e()}}):fetch(k).then(e=>e.json()).then(e=>{$={...e,...$},console.log("[Nick Colors] Loaded remote overrides:",Object.keys(e).length)}).catch(e=>console.error("[Nick Colors] Failed to fetch remote overrides:",e)).finally(e)}).then(()=>{de()}),new MutationObserver(e=>{let t=!1;for(const n of e)if(n.addedNodes.length>0){t=!0;break}t&&de()}).observe(document.body,{childList:!0,subtree:!0}),new MutationObserver(e=>{for(const t of e)if("data-theme"===t.attributeName){console.log("[Nick Colors] Theme changed, refreshing colors",t),H=t.target.getAttribute("data-theme")||null,R(),O(),x(),S();break}}).observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),console.log("[Nick Colors] Loaded. Right-click any colored username to customize.")}();